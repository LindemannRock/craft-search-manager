!function(t){"use strict";t.lrSearchAnalyticsInit=function(e){const a=e||{};function s(){var e=t.Craft&&Craft.$||t.jQuery||t.$;if(!e)return void console.error("Search analytics requires jQuery.");const s=a.strings||{},n=a.endpoints||{},o=t.Craft&&Craft.getActionUrl&&n.data?Craft.getActionUrl(n.data):n.data,r=a.csrfToken||"",c=a.csrfName||"";t.smCharts=t.smCharts||{};let l=a.dateRange||"last7days",d=a.siteId||"";function i(){const e=t.location.hash?t.location.hash.substring(1):"";if(e&&document.getElementById(e))return e;const a=document.querySelector(".lr-tab-content:not(.hidden)");return a?a.id:"overview"}function u(t){if(!t)return;t.style.display="";const e=t.parentElement||t.parentNode;e&&e.querySelectorAll(".zilch").forEach(t=>t.remove())}function p(t,e){if(!t)return;u(t),t.style.display="none";const a=t.parentElement||t.parentNode;if(!a)return;const s=document.createElement("div");s.className="zilch",s.style.padding="40px",s.style.textAlign="center",s.innerHTML='<p class="light">'+e+"</p>",a.appendChild(s)}function h(){Object.values(t.smCharts).forEach(t=>t.destroy()),t.smCharts={};const n=a.csrfToken||"",r=a.csrfName||"",c=["#0d78f2","#27ae60","#e74c3c","#f39c12","#9b59b6"];e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:l,siteId:d,type:"chart",[r]:n},success:function(e){const a=e&&e.success?e.data.chartData:null,n=document.getElementById("404-trend-chart");if(!n)return;const o=Array.isArray(a)&&a.some(t=>Number(t.withResults)>0||Number(t.zeroResults)>0);a&&0!==a.length&&o?(u(n),t.smCharts.trend=new Chart(n,{type:"line",data:{labels:a.map(t=>t.date),datasets:[{label:"With Hits",data:a.map(t=>t.withResults),borderColor:"#10B981",tension:.1},{label:"Zero Hits",data:a.map(t=>t.zeroResults),borderColor:"#EF4444",tension:.1}]},options:{responsive:!0,maintainAspectRatio:!1}})):p(n,s.noTrend)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:l,siteId:d,type:"device-stats",[r]:n},success:function(e){const a=e&&e.success?e.data.deviceStats:null,n=a?a.botStats:null,o=a?a.deviceBreakdown:null,r=a?a.browserBreakdown:null,l=a?a.osBreakdown:null,d=document.getElementById("bot-chart");n&&n.chart&&Array.isArray(n.chart.values)&&n.chart.values.some(t=>Number(t)>0)&&d?(u(d),t.smCharts.bot=new Chart(d,{type:"doughnut",data:{labels:n.chart.labels,datasets:[{data:n.chart.values,backgroundColor:["#27ae60","#e74c3c"]}]}})):d&&p(d,s.noBot);const i=document.getElementById("device-chart");o&&o.labels&&o.labels.length&&Array.isArray(o.values)&&o.values.some(t=>Number(t)>0)?(u(i),t.smCharts.device=new Chart(i,{type:"doughnut",data:{labels:o.labels,datasets:[{data:o.values,backgroundColor:c}]}})):i&&p(i,s.noDevice);const h=document.getElementById("browser-chart");r&&r.labels&&r.labels.length&&Array.isArray(r.values)&&r.values.some(t=>Number(t)>0)?(u(h),t.smCharts.browser=new Chart(h,{type:"bar",data:{labels:r.labels,datasets:[{label:s.searchesLabel,data:r.values,backgroundColor:"#0d78f2"}]}})):h&&p(h,s.noBrowser);const y=document.getElementById("os-chart");l&&l.labels&&l.labels.length&&Array.isArray(l.values)&&l.values.some(t=>Number(t)>0)?(u(y),t.smCharts.os=new Chart(y,{type:"doughnut",data:{labels:l.labels,datasets:[{data:l.values,backgroundColor:c}]}})):y&&p(y,s.noOs)}})}function y(e){const a=e||t.lrAnalyticsConfig||{};l=a.dateRange||l,d=a.siteId||"",t.performanceLoaded=!1,t.trafficDevicesLoaded=!1,t.geographicLoaded=!1,t.queryRulesLoaded=!1,t.promotionsLoaded=!1,h();g(i())}function g(n){"overview"===n&&e("#word-cloud-container").children().length>0||"content-gaps"===n&&e("#content-gaps-body tr").length>1||"performance"===n&&t.performanceLoaded||"traffic-devices"===n&&t.trafficDevicesLoaded||"geographic"===n&&t.geographicLoaded||"query-rules"===n&&t.queryRulesLoaded||"promotions"===n&&t.promotionsLoaded||("performance"!==n?"traffic-devices"!==n?"geographic"!==n?"query-rules"!==n?"promotions"!==n?e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:l,siteId:d,type:{overview:"query-analysis","content-gaps":"content-gaps"}[n],[c]:r},success:function(r){r.success&&("overview"===n&&(function(a){if(a.lengthDistribution&&a.lengthDistribution.labels&&a.lengthDistribution.labels.length&&m(a.lengthDistribution.values))!function(t){if("undefined"==typeof Chart||!Chart.getChart)return;const e=Chart.getChart(t);e&&e.destroy()}("query-length-chart"),t.smCharts.length&&(t.smCharts.length.destroy(),delete t.smCharts.length),t.smCharts.length=new Chart(document.getElementById("query-length-chart"),{type:"pie",data:{labels:a.lengthDistribution.labels,datasets:[{data:a.lengthDistribution.values,backgroundColor:["#3498db","#9b59b6","#34495e"]}]}});else{const t=document.getElementById("query-length-chart");t&&p(t,s.noQueryLength),e("#query-length-legend").empty()}const n=e("#word-cloud-container");if(n.empty(),a.wordCloud&&a.wordCloud.length){const t=Math.max(...a.wordCloud.map(t=>t.weight)),s=12,o=48;a.wordCloud.forEach(a=>{const r=s+a.weight/t*(o-s),c=e("<span>").text(a.text).addClass("lr-word-cloud-item").css("fontSize",r+"px").attr("title",a.weight+" searches");n.append(c).append(" ")})}else n.html('<div class="zilch" style="padding: 40px; text-align: center;"><p class="light">'+s.noWordCloud+"</p></div>")}(r.data.queryAnalysis),function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"intent",[l]:c},success:function(e){e.success&&function(e){t.smCharts.intent&&t.smCharts.intent.destroy();const a=document.getElementById("intent-chart");if(!a)return;if(!e.labels||0===e.labels.length)return void p(a,s.noIntent);const n=["#3498db","#2ecc71","#f39c12","#9b59b6","#e74c3c"];t.smCharts.intent=new Chart(a,{type:"doughnut",data:{labels:e.labels.map(t=>t.charAt(0).toUpperCase()+t.slice(1)),datasets:[{data:e.values,backgroundColor:n.slice(0,e.labels.length)}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}(e.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"source",[l]:c},success:function(e){e.success&&function(e){t.smCharts.source&&t.smCharts.source.destroy();const a=document.getElementById("source-chart");if(!a)return;if(!e.labels||0===e.labels.length)return void p(a,s.noSource);const n=["#27ae60","#3498db","#e67e22","#9b59b6","#1abc9c","#e74c3c"];t.smCharts.source=new Chart(a,{type:"doughnut",data:{labels:e.labels,datasets:[{data:e.values,backgroundColor:n.slice(0,e.labels.length)}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}(e.data)}})}(l,d),function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"hourly",[l]:c},success:function(a){a.success&&function(a){const n=document.getElementById("peak-hours-chart");if(!n)return;t.smCharts.peakHours&&t.smCharts.peakHours.destroy();if(!a||!a.data||!m(a.data))return p(n,s.noPeakHour),void e("#peak-hour-label").empty();t.smCharts.peakHours=new Chart(n,{type:"bar",data:{labels:a.labels,datasets:[{label:s.searchesLabel,data:a.data,backgroundColor:a.data.map((t,e)=>e===a.peakHour?"#e74c3c":"rgba(13, 120, 242, 0.7)"),borderColor:a.data.map((t,e)=>e===a.peakHour?"#c0392b":"#0d78f2"),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}},x:{ticks:{maxRotation:45,minRotation:45}}}}}),n.style.width="100%",n.style.height="100%",a.peakHourFormatted&&e("#peak-hour-label").html("<strong>"+s.peakHourLabel+"</strong> "+a.peakHourFormatted)}(a.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"trending",[l]:c},success:function(t){t.success&&function(t){const a=e("#trending-queries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="4" class="thin light lr-text-center">'+s.noTrending+"</td></tr>");t.forEach(t=>{let e="",n="",o="";switch(t.trend){case"up":e='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg>',n="#27ae60",o="+"+t.changePercent+"%";break;case"down":e='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>',n="#e74c3c",o="-"+t.changePercent+"%";break;case"new":e='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4" fill="currentColor"></circle></svg>',n="#3498db",o=s.newLabel;break;default:e='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line></svg>',n="#95a5a6",o="—"}a.append(`<tr>\n                <td><code>${Craft.escapeHtml(t.query)}</code></td>\n                <td class="lr-text-end">${t.count.toLocaleString()}</td>\n                <td class="lr-text-end lr-text-muted">${t.previousCount>0?t.previousCount.toLocaleString():"—"}</td>\n                <td class="lr-text-end" style="color: ${n};">\n                    <span class="lr-inline-flex lr-gap-4">\n                        ${e} ${o}\n                    </span>\n                </td>\n            </tr>`)})}(t.data)}})}(l,d)),"content-gaps"===n&&function(t){const a=e("#content-gaps-body");if(a.empty(),!t.clusters||0===t.clusters.length)return void a.html('<tr><td colspan="4" class="thin light lr-text-center">'+s.noContentGaps+"</td></tr>");t.clusters.forEach(t=>{let e=`<tr>\n                <td><strong>${Craft.escapeHtml(t.representative)}</strong></td>\n                <td>${t.count.toLocaleString()}</td>\n                <td>${t.queries.slice(0,3).join(", ")}</td>\n                <td>${t.lastSearched}</td>\n            </tr>`;a.append(e)})}(r.data.contentGaps))},error:function(){console.error("Failed to load tab data")}}):function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"promotions-top",[l]:c},success:function(t){t.success&&function(t){const a=e("#top-promotions-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="4" class="light lr-text-center">'+s.noPromotionsShown+"</td></tr>");t.forEach(t=>{a.append(`<tr>\n                <td><strong>${Craft.escapeHtml(t.elementTitle||"Element #"+t.elementId)}</strong></td>\n                <td>#${t.position}</td>\n                <td>${t.impressions.toLocaleString()}</td>\n                <td>${t.uniqueQueries.toLocaleString()}</td>\n            </tr>`)})}(t.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"promotions-by-position",[l]:c},success:function(e){e.success&&function(e){t.smCharts.promosByPosition&&t.smCharts.promosByPosition.destroy();const a=document.getElementById("promotions-by-position-chart");if(!a)return;if(!e.labels||0===e.labels.length)return void p(a,s.noDataFilters);t.smCharts.promosByPosition=new Chart(a,{type:"bar",data:{labels:e.labels.map(t=>"Position #"+t),datasets:[{label:"Impressions",data:e.values,backgroundColor:"#0d78f2"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})}(e.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"promotions-queries",[l]:c},success:function(a){a.success&&function(t){const a=e("#promotion-queries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="3" class="light lr-text-center">'+s.noPromotionQueries+"</td></tr>");t.forEach(t=>{a.append(`<tr>\n                <td><code>${Craft.escapeHtml(t.query)}</code></td>\n                <td>${t.promotionsShown.toLocaleString()}</td>\n                <td>${t.count.toLocaleString()}</td>\n            </tr>`)})}(a.data),t.promotionsLoaded=!0}})}(l,d):function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"query-rules-top",[l]:c},success:function(t){t.success&&function(t){const a=e("#top-rules-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="4" class="light lr-text-center">'+s.noQueryRules+"</td></tr>");t.forEach(t=>{const e=f[t.actionType]||Craft.escapeHtml(t.actionType||"");a.append(`<tr>\n                <td><strong>${Craft.escapeHtml(t.ruleName)}</strong></td>\n                <td>${e}</td>\n                <td>${t.hits.toLocaleString()}</td>\n                <td>${t.avgResults.toLocaleString()}</td>\n            </tr>`)})}(t.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"query-rules-by-type",[l]:c},success:function(e){e.success&&function(e){t.smCharts.rulesByType&&t.smCharts.rulesByType.destroy();const a=document.getElementById("rules-by-type-chart");if(!a)return;if(!e.labels||0===e.labels.length)return void p(a,s.noDataFilters);const n={synonym:"#3498db",boost_section:"#2ecc71",boost_category:"#27ae60",boost_element:"#1abc9c",filter:"#f39c12",redirect:"#e74c3c"};t.smCharts.rulesByType=new Chart(a,{type:"doughnut",data:{labels:e.labels.map(t=>t.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())),datasets:[{data:e.values,backgroundColor:e.labels.map(t=>n[t]||"#95a5a6")}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),a.style.width="100%",a.style.height="100%"}(e.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"query-rules-queries",[l]:c},success:function(a){a.success&&function(t){const a=e("#rule-queries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="3" class="light lr-text-center">'+s.noRuleQueries+"</td></tr>");t.forEach(t=>{a.append(`<tr>\n                <td><code>${Craft.escapeHtml(t.query)}</code></td>\n                <td>${t.rulesTriggered.toLocaleString()}</td>\n                <td>${t.count.toLocaleString()}</td>\n            </tr>`)})}(a.data),t.queryRulesLoaded=!0}})}(l,d):function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"countries",[l]:c},success:function(t){t.success&&function(t){const a=e("#countries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="3" class="light lr-text-center">'+s.noDataAvailable+"</td></tr>");t.forEach(t=>{a.append(`<tr><td>${Craft.escapeHtml(t.name)}</td><td>${t.count.toLocaleString()}</td><td>${t.percentage}%</td></tr>`)})}(t.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"cities",[l]:c},success:function(a){a.success&&function(t){const a=e("#cities-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="3" class="light lr-text-center">'+s.noDataAvailable+"</td></tr>");t.forEach(t=>{a.append(`<tr><td>${Craft.escapeHtml(t.city)}</td><td>${Craft.escapeHtml(t.countryName)}</td><td>${t.count.toLocaleString()}</td></tr>`)})}(a.data),t.geographicLoaded=!0}})}(l,d):function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"hourly",[l]:c},success:function(a){a.success&&function(e){const a=document.getElementById("hourly-chart");if(!a)return;if(!e||!e.data||!m(e.data))return void p(a,s.noUsage);t.smCharts.hourly&&t.smCharts.hourly.destroy();t.smCharts.hourly=new Chart(a,{type:"bar",data:{labels:e.labels,datasets:[{label:s.searchesLabel,data:e.data,backgroundColor:"#0d78f2"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Peak Hour: "+e.peakHourFormatted}}}})}(a.data),e("#analytics-dashboard").css("opacity","1"),t.trafficDevicesLoaded=!0}})}(l,d):function(n,r){const c=a.csrfToken||"",l=a.csrfName||"";e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"cache-stats",[l]:c},success:function(t){var a;t.success&&(a=t.data,e("#cache-hit-rate").text(a.hitRate+"%"),e("#cache-hits").text(a.cacheHits.toLocaleString()),e("#cache-misses").text(a.cacheMisses.toLocaleString()),e("#total-searches-perf").text(a.total.toLocaleString()))}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"performance",[l]:c},success:function(e){e.success&&function(e){t.smCharts.performance&&t.smCharts.performance.destroy();const a=document.getElementById("performance-chart");if(!a)return;if(!e.labels||0===e.labels.length)return void p(a,s.noPerformance);t.smCharts.performance=new Chart(a,{type:"line",data:{labels:e.labels,datasets:[{label:"Avg Response Time (ms)",data:e.avgTime,borderColor:"#3498db",backgroundColor:"rgba(52, 152, 219, 0.1)",fill:!0,tension:.3}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"ms"}}}}})}(e.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"top-queries",[l]:c},success:function(t){t.success&&function(t){const a=e("#top-queries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="4" class="thin light lr-text-center">'+s.notEnoughData+"</td></tr>");t.forEach(t=>{a.append(`<tr>\n                <td><code>${Craft.escapeHtml(t.query)}</code></td>\n                <td>${t.siteName||"—"}</td>\n                <td><strong>${t.avgTime}ms</strong></td>\n                <td>${t.searches.toLocaleString()}</td>\n            </tr>`)})}(t.data)}}),e.ajax({url:o,type:"POST",dataType:"json",data:{dateRange:n,siteId:r,type:"worst-queries",[l]:c},success:function(t){t.success&&function(t){const a=e("#worst-queries-body");if(a.empty(),!t||0===t.length)return void a.html('<tr><td colspan="4" class="thin light lr-text-center">'+s.notEnoughData+"</td></tr>");t.forEach(t=>{a.append(`<tr>\n                <td><code>${Craft.escapeHtml(t.query)}</code></td>\n                <td>${t.siteName||"—"}</td>\n                <td><strong class="${t.avgTime>100?"lr-text-red":""}">${t.avgTime}ms</strong></td>\n                <td>${t.searches.toLocaleString()}</td>\n            </tr>`)})}(t.data)}}),t.performanceLoaded=!0}(l,d))}function m(t){return!(!Array.isArray(t)||0===t.length)&&t.some(t=>Number(t)>0)}document.addEventListener("lr:analyticsInit",function(t){y(t.detail&&t.detail.config?t.detail.config:null)}),document.addEventListener("lr:tabChanged",function(t){g(t.detail&&t.detail.tabId?t.detail.tabId:i())});const f=a.actionTypeBadges||{};t.lrAnalyticsConfig&&y(t.lrAnalyticsConfig)}t.lrSearchAnalyticsBound?t.lrAnalyticsInit&&t.lrAnalyticsInit(a):(t.lrSearchAnalyticsBound=!0,t.lrAnalyticsInit&&t.lrAnalyticsInit(a),t.Garnish&&Garnish.onReady?Garnish.onReady(s):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s())}}(window);