(()=>{var u={modalBg:"--sm-modal-bg",modalBgDark:"--sm-modal-bg-dark",modalBorderRadius:"--sm-modal-radius",modalBorderWidth:"--sm-modal-border-width",modalBorderColor:"--sm-modal-border-color",modalBorderColorDark:"--sm-modal-border-color-dark",modalShadow:"--sm-modal-shadow",modalShadowDark:"--sm-modal-shadow-dark",modalMaxWidth:"--sm-modal-width",inputBg:"--sm-input-bg",inputBgDark:"--sm-input-bg-dark",inputTextColor:"--sm-input-color",inputTextColorDark:"--sm-input-color-dark",inputPlaceholderColor:"--sm-input-placeholder",inputPlaceholderColorDark:"--sm-input-placeholder-dark",inputBorderColor:"--sm-input-border-color",inputBorderColorDark:"--sm-input-border-color-dark",inputFontSize:"--sm-input-font-size",resultBg:"--sm-result-bg",resultBgDark:"--sm-result-bg-dark",resultHoverBg:"--sm-result-hover-bg",resultHoverBgDark:"--sm-result-hover-bg-dark",resultActiveBg:"--sm-result-active-bg",resultActiveBgDark:"--sm-result-active-bg-dark",resultTextColor:"--sm-result-text-color",resultTextColorDark:"--sm-result-text-color-dark",resultDescColor:"--sm-result-desc-color",resultDescColorDark:"--sm-result-desc-color-dark",resultMutedColor:"--sm-result-muted-color",resultMutedColorDark:"--sm-result-muted-color-dark",resultBorderRadius:"--sm-result-radius",triggerBg:"--sm-trigger-bg",triggerBgDark:"--sm-trigger-bg-dark",triggerTextColor:"--sm-trigger-text-color",triggerTextColorDark:"--sm-trigger-text-color-dark",triggerBorderRadius:"--sm-trigger-radius",triggerBorderWidth:"--sm-trigger-border-width",triggerBorderColor:"--sm-trigger-border-color",triggerBorderColorDark:"--sm-trigger-border-color-dark",triggerPaddingX:"--sm-trigger-px",triggerPaddingY:"--sm-trigger-py",triggerFontSize:"--sm-trigger-font-size",kbdBg:"--sm-kbd-bg",kbdBgDark:"--sm-kbd-bg-dark",kbdTextColor:"--sm-kbd-text-color",kbdTextColorDark:"--sm-kbd-text-color-dark",kbdBorderRadius:"--sm-kbd-radius",highlightBgLight:"--sm-highlight-bg",highlightColorLight:"--sm-highlight-color",highlightBgDark:"--sm-highlight-bg-dark",highlightColorDark:"--sm-highlight-color-dark"},p=["modalBorderRadius","modalBorderWidth","modalMaxWidth","inputFontSize","resultBorderRadius","triggerBorderRadius","triggerBorderWidth","triggerPaddingX","triggerPaddingY","triggerFontSize","kbdBorderRadius"],b=["modalBg","modalBgDark","modalBorderColor","modalBorderColorDark","inputBg","inputBgDark","inputTextColor","inputTextColorDark","inputPlaceholderColor","inputPlaceholderColorDark","inputBorderColor","inputBorderColorDark","resultBg","resultBgDark","resultHoverBg","resultHoverBgDark","resultActiveBg","resultActiveBgDark","resultTextColor","resultTextColorDark","resultDescColor","resultDescColorDark","resultMutedColor","resultMutedColorDark","triggerBg","triggerBgDark","triggerTextColor","triggerTextColorDark","triggerBorderColor","triggerBorderColorDark","kbdBg","kbdBgDark","kbdTextColor","kbdTextColorDark","highlightBgLight","highlightColorLight","highlightBgDark","highlightColorDark"];function S(i){return/^[0-9a-fA-F]{6}$/.test(i)}function D(i,e){if(e==null||e==="")return null;let t=String(e);return b.includes(i)&&S(t)&&(t="#"+t),p.includes(i)&&(t=t+"px"),t}function f(i,e,t="light"){if(!e||typeof e!="object")return;let r=t==="dark";for(let[s,n]of Object.entries(u)){let o=s.endsWith("Dark");if(!(r&&!o)&&!(!r&&o)&&e[s]!==void 0&&e[s]!==null&&e[s]!==""){let a=D(s,e[s]);a&&i.style.setProperty(n,a)}}}var R="sm-recent-";function m(i){return`${R}${i||"default"}`}function c(i){try{let e=m(i),t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}}function k(i,e,t=null){if(!e||!e.trim())return c(i);let r=m(i),s={query:e.trim(),title:t?.title||e,url:t?.url||null,timestamp:Date.now()},n=c(i);n=n.filter(o=>o.query!==s.query),n.unshift(s),n=n.slice(0,5);try{localStorage.setItem(r,JSON.stringify(n))}catch{}return n}function x(i){try{let e=m(i);localStorage.removeItem(e)}catch{}}async function v({query:i,endpoint:e,indices:t=[],siteId:r="",maxResults:s=10,signal:n}){let o=new URLSearchParams({q:i,limit:s.toString()});t.length>0&&o.append("indices",t.join(",")),r&&o.append("siteId",r);let a=e.includes("?")?"&":"?",l=await fetch(`${e}${a}${o}`,{signal:n,headers:{Accept:"application/json"}});if(!l.ok)throw new Error("Search failed");let d=await l.json();return d.results||d.hits||[]}function y({endpoint:i,elementId:e,query:t,index:r}){if(!(!e||!i))try{let s=new FormData;s.append("elementId",e),s.append("query",t),s.append("index",r),fetch(i,{method:"POST",body:s}).catch(()=>{})}catch{}}function w(i){let e={};return i.forEach(t=>{let r=t.section||t.type||"Results";e[r]||(e[r]=[]),e[r].push(t)}),e}var C=`/**
 * Search Widget Styles
 * These styles are injected into the shadow DOM
 */

:host {
    /* Modal defaults - inline styles from config will override same-name vars */
    --sm-modal-bg: #ffffff;
    --sm-modal-border: var(--sm-modal-border-color, #e5e7eb);
    --sm-modal-border-width: 1px;
    --sm-modal-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --sm-modal-radius: 12px;
    --sm-modal-width: 640px;
    --sm-modal-max-height: 80vh;

    /* Input defaults */
    --sm-input-bg: #ffffff;
    --sm-input-color: #111827;
    --sm-input-placeholder: #9ca3af;
    --sm-input-font-size: 16px;

    /* Text colors - map from config variable names */
    --sm-text-primary: var(--sm-result-text-color, #111827);
    --sm-text-secondary: var(--sm-result-desc-color, #6b7280);
    --sm-text-muted: var(--sm-result-muted-color, #9ca3af);

    /* Borders and backgrounds - map from config variable names */
    --sm-border-color: var(--sm-input-border-color, #e5e7eb);
    --sm-hover-bg: var(--sm-result-hover-bg, #f3f4f6);
    --sm-selected-bg: var(--sm-result-active-bg, #e5e7eb);
    --sm-selected-border: #3b82f6;
    --sm-result-radius: 8px;

    /* Highlighting */
    --sm-highlight-bg: #fef08a;
    --sm-highlight-color: #854d0e;

    /* Kbd / keyboard shortcuts */
    --sm-kbd-bg: #f3f4f6;
    --sm-kbd-border: #d1d5db;
    --sm-kbd-color: var(--sm-kbd-text-color, #6b7280);
    --sm-kbd-radius: 4px;

    /* Trigger button */
    --sm-trigger-bg: #ffffff;
    --sm-trigger-color: var(--sm-trigger-text-color, #374151);
    --sm-trigger-border: var(--sm-trigger-border-color, #d1d5db);
    --sm-trigger-radius: 8px;
    --sm-trigger-border-width: 1px;
    --sm-trigger-px: 12px;
    --sm-trigger-py: 8px;
    --sm-trigger-font-size: 14px;

    /* Accent colors */
    --sm-accent: #3b82f6;
    --sm-accent-hover: #2563eb;

    display: inline-block;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

/* Dark theme - uses custom dark variables with fallbacks */
:host([data-theme="dark"]) {
    --sm-modal-bg: var(--sm-modal-bg-dark, #1f2937);
    --sm-modal-border: var(--sm-modal-border-color-dark, #374151);

    --sm-input-bg: var(--sm-input-bg-dark, #1f2937);
    --sm-input-color: var(--sm-input-color-dark, #f9fafb);
    --sm-input-placeholder: var(--sm-input-placeholder-dark, #6b7280);

    --sm-text-primary: var(--sm-result-text-color-dark, #f9fafb);
    --sm-text-secondary: var(--sm-result-desc-color-dark, #9ca3af);
    --sm-text-muted: var(--sm-result-muted-color-dark, #6b7280);

    --sm-border-color: var(--sm-input-border-color-dark, #374151);
    --sm-hover-bg: var(--sm-result-hover-bg-dark, #374151);
    --sm-selected-bg: var(--sm-result-active-bg-dark, #4b5563);
    --sm-selected-border: #3b82f6;

    --sm-highlight-bg: var(--sm-highlight-bg-dark, #854d0e);
    --sm-highlight-color: var(--sm-highlight-color-dark, #fef08a);

    --sm-kbd-bg: var(--sm-kbd-bg-dark, #4b5563);
    --sm-kbd-border: #4b5563;
    --sm-kbd-color: var(--sm-kbd-text-color-dark, #9ca3af);

    --sm-trigger-bg: var(--sm-trigger-bg-dark, #374151);
    --sm-trigger-color: var(--sm-trigger-text-color-dark, #d1d5db);
    --sm-trigger-border: var(--sm-trigger-border-color-dark, #4b5563);
}

*, *::before, *::after {
    box-sizing: border-box;
}

/* Trigger button */
.sm-trigger {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: var(--sm-trigger-py) var(--sm-trigger-px);
    background: var(--sm-trigger-bg);
    border: var(--sm-trigger-border-width) solid var(--sm-trigger-border);
    border-radius: var(--sm-trigger-radius);
    color: var(--sm-trigger-color);
    font-size: var(--sm-trigger-font-size);
    cursor: pointer;
    transition: all 0.15s ease;
}

.sm-trigger:hover {
    border-color: var(--sm-accent);
    color: var(--sm-text-primary);
}

.sm-trigger-kbd {
    display: inline-flex;
    align-items: center;
    padding: 2px 6px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

/* Backdrop */
.sm-backdrop {
    position: fixed;
    inset: 0;
    z-index: 99999;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 10vh;
    background: rgba(0, 0, 0, var(--sm-backdrop-opacity, 0.5));
    backdrop-filter: var(--sm-backdrop-blur, blur(4px));
    animation: sm-fade-in 0.15s ease;
}

.sm-backdrop[hidden] {
    display: none;
}

@keyframes sm-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Modal */
.sm-modal {
    width: var(--sm-modal-width);
    max-width: calc(100vw - 32px);
    max-height: var(--sm-modal-max-height);
    background: var(--sm-modal-bg);
    border: var(--sm-modal-border-width, 1px) solid var(--sm-modal-border);
    border-radius: var(--sm-modal-radius);
    box-shadow: var(--sm-modal-shadow);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: sm-slide-up 0.2s ease;
}

@keyframes sm-slide-up {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Header */
.sm-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-bottom: 1px solid var(--sm-border-color);
}

.sm-search-icon {
    flex-shrink: 0;
    color: var(--sm-text-muted);
}

.sm-input {
    flex: 1;
    border: none;
    background: var(--sm-input-bg);
    color: var(--sm-input-color);
    font-size: var(--sm-input-font-size);
    outline: none;
}

.sm-input::placeholder {
    color: var(--sm-input-placeholder);
}

.sm-loading {
    flex-shrink: 0;
}

.sm-spinner {
    animation: sm-spin 1s linear infinite;
    color: var(--sm-accent);
}

@keyframes sm-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.sm-close {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 4px 8px;
    background: transparent;
    border: none;
    cursor: pointer;
}

.sm-close kbd {
    padding: 2px 6px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

/* Results */
.sm-results {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

.sm-section {
    margin-bottom: 8px;
}

.sm-section:last-child {
    margin-bottom: 0;
}

.sm-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--sm-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.sm-clear-recent {
    padding: 2px 8px;
    background: transparent;
    border: none;
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    color: var(--sm-text-muted);
    cursor: pointer;
    text-transform: none;
    letter-spacing: normal;
}

.sm-clear-recent:hover {
    background: var(--sm-hover-bg);
    color: var(--sm-text-secondary);
}

/* Result item */
.sm-result-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: var(--sm-result-radius);
    color: var(--sm-text-primary);
    text-decoration: none;
    cursor: pointer;
    transition: background 0.1s ease;
}

.sm-result-item:hover,
.sm-result-item.sm-selected {
    background: var(--sm-hover-bg);
}

.sm-result-item.sm-selected {
    background: var(--sm-selected-bg);
    outline: 2px solid var(--sm-selected-border);
    outline-offset: -2px;
}

.sm-result-icon {
    flex-shrink: 0;
    color: var(--sm-text-muted);
}

.sm-result-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sm-result-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--sm-text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.sm-result-desc {
    font-size: 13px;
    color: var(--sm-text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.sm-result-type {
    flex-shrink: 0;
    padding: 2px 8px;
    background: var(--sm-kbd-bg);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    color: var(--sm-text-muted);
}

.sm-result-arrow {
    flex-shrink: 0;
    color: var(--sm-text-muted);
    opacity: 0;
    transition: opacity 0.1s ease;
}

.sm-result-item:hover .sm-result-arrow,
.sm-result-item.sm-selected .sm-result-arrow {
    opacity: 1;
}

/* Highlight - uses .sm-highlight class to work with any tag */
.sm-highlight {
    background: var(--sm-highlight-bg);
    color: var(--sm-highlight-color);
    border-radius: 2px;
    padding: 0 2px;
}

/* Empty state */
.sm-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 48px 24px;
    color: var(--sm-text-muted);
    text-align: center;
}

.sm-empty p {
    margin: 0;
    font-size: 14px;
}

.sm-empty strong {
    color: var(--sm-text-secondary);
}

/* Footer */
.sm-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 12px 16px;
    border-top: 1px solid var(--sm-border-color);
    font-size: 12px;
    color: var(--sm-text-muted);
}

.sm-footer-hints {
    display: flex;
    align-items: center;
    gap: 12px;
}

.sm-footer-hints span {
    display: flex;
    align-items: center;
    gap: 4px;
}

.sm-footer kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    padding: 2px 4px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 10px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

.sm-footer-brand {
    color: var(--sm-text-muted);
}

.sm-footer-brand strong {
    color: var(--sm-text-secondary);
}

/* RTL support */
:host([dir="rtl"]) .sm-header,
:host([dir="rtl"]) .sm-result-item,
:host([dir="rtl"]) .sm-footer {
    direction: rtl;
}

:host([dir="rtl"]) .sm-result-arrow {
    transform: scaleX(-1);
}

/* Mobile */
@media (max-width: 640px) {
    .sm-backdrop {
        padding-top: 0;
        align-items: flex-end;
    }

    .sm-modal {
        max-width: 100%;
        max-height: 90vh;
        border-radius: var(--sm-modal-radius) var(--sm-modal-radius) 0 0;
    }

    .sm-trigger-text,
    .sm-footer-hints {
        display: none;
    }
}
`;var h=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.isOpen=!1,this.results=[],this.recentSearches=[],this.selectedIndex=-1,this.loading=!1,this.query="",this.debounceTimer=null,this.abortController=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleGlobalKeydown=this.handleGlobalKeydown.bind(this),this.handleInput=this.handleInput.bind(this),this.handleResultClick=this.handleResultClick.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this)}static get observedAttributes(){return["indices","placeholder","endpoint","theme","max-results","debounce","min-chars","show-recent","group-results","hotkey","site-id","enable-highlighting","highlight-tag","highlight-class","backdrop-opacity","enable-backdrop-blur","prevent-body-scroll","show-trigger","trigger-selector","styles"]}get styles(){let e=this.getAttribute("styles");if(e)try{return JSON.parse(e)}catch(t){console.warn("SearchWidget: Invalid styles JSON",t)}return{}}get config(){let e=this.getAttribute("indices")||"",t=e?e.split(",").map(r=>r.trim()).filter(Boolean):[];return{indices:t,index:t[0]||"",placeholder:this.getAttribute("placeholder")||"Search...",endpoint:this.getAttribute("endpoint")||"/actions/search-manager/search/query",theme:this.getAttribute("theme")||"light",maxResults:parseInt(this.getAttribute("max-results"))||10,debounce:parseInt(this.getAttribute("debounce"))||200,minChars:parseInt(this.getAttribute("min-chars"))||2,showRecent:this.getAttribute("show-recent")!=="false",groupResults:this.getAttribute("group-results")!=="false",hotkey:this.getAttribute("hotkey")||"k",siteId:this.getAttribute("site-id")||"",analyticsEndpoint:this.getAttribute("analytics-endpoint")||"/actions/search-manager/search/track-click",enableHighlighting:this.getAttribute("enable-highlighting")!=="false",highlightTag:this.getAttribute("highlight-tag")||"mark",highlightClass:this.getAttribute("highlight-class")||"",backdropOpacity:parseInt(this.getAttribute("backdrop-opacity"))||50,enableBackdropBlur:this.getAttribute("enable-backdrop-blur")!=="false",preventBodyScroll:this.getAttribute("prevent-body-scroll")!=="false",showTrigger:this.getAttribute("show-trigger")!=="false",triggerSelector:this.getAttribute("trigger-selector")||""}}connectedCallback(){this.render(),this.recentSearches=c(this.config.index),this.attachEventListeners()}disconnectedCallback(){this.detachEventListeners()}attributeChangedCallback(e,t,r){t!==r&&this.shadowRoot.querySelector(".sm-modal")&&this.render()}render(){let{theme:e,placeholder:t,showTrigger:r}=this.config;this.shadowRoot.innerHTML=`
            <style>${C}</style>

            <!-- Trigger button -->
            <button class="sm-trigger" part="trigger" aria-label="Open search" ${r?"":'style="display: none;"'}>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <span class="sm-trigger-text">Search</span>
                <kbd class="sm-trigger-kbd">${this.getHotkeyDisplay()}</kbd>
            </button>

            <!-- Modal backdrop -->
            <div class="sm-backdrop" part="backdrop" hidden>
                <div class="sm-modal" part="modal" role="dialog" aria-modal="true" aria-label="Search">
                    <!-- Search input -->
                    <div class="sm-header" part="header">
                        <svg class="sm-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input
                            type="text"
                            class="sm-input"
                            part="input"
                            placeholder="${t}"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div class="sm-loading" part="loading" hidden>
                            <svg class="sm-spinner" width="20" height="20" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" opacity="0.25"/>
                                <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <button class="sm-close" part="close" aria-label="Close search">
                            <kbd>esc</kbd>
                        </button>
                    </div>

                    <!-- Results -->
                    <div class="sm-results" part="results" role="listbox"></div>

                    <!-- Footer -->
                    <div class="sm-footer" part="footer">
                        <div class="sm-footer-hints">
                            <span><kbd>\u2191</kbd><kbd>\u2193</kbd> navigate</span>
                            <span><kbd>\u21B5</kbd> select</span>
                            <span><kbd>esc</kbd> close</span>
                        </div>
                        <div class="sm-footer-brand">
                            Powered by <strong>Search Manager</strong>
                        </div>
                    </div>
                </div>
            </div>
        `,this.elements={trigger:this.shadowRoot.querySelector(".sm-trigger"),backdrop:this.shadowRoot.querySelector(".sm-backdrop"),modal:this.shadowRoot.querySelector(".sm-modal"),input:this.shadowRoot.querySelector(".sm-input"),results:this.shadowRoot.querySelector(".sm-results"),loading:this.shadowRoot.querySelector(".sm-loading"),close:this.shadowRoot.querySelector(".sm-close")},this.shadowRoot.host.setAttribute("data-theme",e),this.applyCustomStyles()}applyCustomStyles(){let{backdropOpacity:e,enableBackdropBlur:t,theme:r}=this.config,s=this.shadowRoot.host;s.style.setProperty("--sm-backdrop-opacity",e/100),s.style.setProperty("--sm-backdrop-blur",t?"blur(4px)":"none"),f(s,this.styles,r)}getHotkeyDisplay(){let e=navigator.platform.toUpperCase().indexOf("MAC")>=0,t=this.config.hotkey.toUpperCase();return e?`\u2318${t}`:`Ctrl+${t}`}attachEventListeners(){this.elements.trigger.addEventListener("click",this.toggle),this.elements.close.addEventListener("click",this.close),this.elements.backdrop.addEventListener("click",this.handleBackdropClick),this.elements.input.addEventListener("input",this.handleInput),this.elements.input.addEventListener("keydown",this.handleKeydown),document.addEventListener("keydown",this.handleGlobalKeydown);let{triggerSelector:e}=this.config;e&&(this.externalTrigger=document.querySelector(e),this.externalTrigger&&this.externalTrigger.addEventListener("click",this.toggle))}detachEventListeners(){document.removeEventListener("keydown",this.handleGlobalKeydown),this.externalTrigger&&(this.externalTrigger.removeEventListener("click",this.toggle),this.externalTrigger=null)}handleGlobalKeydown(e){let t=this.config.hotkey.toLowerCase();(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&e.key.toLowerCase()===t&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen&&(e.preventDefault(),this.close())}handleKeydown(e){let t=this.shadowRoot.querySelectorAll(".sm-result-item"),r=t.length;switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,r-1),this.updateSelection();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelection();break;case"Enter":e.preventDefault(),this.selectedIndex>=0&&t[this.selectedIndex]&&t[this.selectedIndex].click();break;case"Escape":e.preventDefault(),this.close();break}}updateSelection(){this.shadowRoot.querySelectorAll(".sm-result-item").forEach((t,r)=>{t.classList.toggle("sm-selected",r===this.selectedIndex),r===this.selectedIndex&&t.scrollIntoView({block:"nearest"})})}handleBackdropClick(e){e.target===this.elements.backdrop&&this.close()}handleInput(e){if(this.query=e.target.value,this.selectedIndex=-1,this.debounceTimer&&clearTimeout(this.debounceTimer),!this.query.trim()){this.results=[],this.renderResults();return}this.query.length<this.config.minChars||(this.debounceTimer=setTimeout(()=>{this.search(this.query)},this.config.debounce))}async search(e){this.abortController&&this.abortController.abort(),this.abortController=new AbortController,this.loading=!0,this.elements.loading.hidden=!1;try{this.results=await v({query:e,endpoint:this.config.endpoint,indices:this.config.indices,siteId:this.config.siteId,maxResults:this.config.maxResults,signal:this.abortController.signal}),this.renderResults()}catch(t){t.name!=="AbortError"&&(console.error("Search error:",t),this.results=[],this.renderResults())}finally{this.loading=!1,this.elements.loading.hidden=!0}}renderResults(){let e=this.elements.results,{showRecent:t,groupResults:r}=this.config;if(!this.query.trim()&&t&&this.recentSearches.length>0){e.innerHTML=`
                <div class="sm-section">
                    <div class="sm-section-header">
                        <span>Recent searches</span>
                        <button class="sm-clear-recent" part="clear-recent">Clear</button>
                    </div>
                    ${this.recentSearches.map((n,o)=>`
                        <div class="sm-result-item sm-recent-item" role="option" data-index="${o}" data-url="${n.url||""}" data-query="${this.escapeHtml(n.query)}">
                            <svg class="sm-result-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span class="sm-result-title">${this.escapeHtml(n.title||n.query)}</span>
                        </div>
                    `).join("")}
                </div>
            `;let s=e.querySelector(".sm-clear-recent");s&&s.addEventListener("click",n=>{n.stopPropagation(),x(this.config.index),this.recentSearches=[],this.renderResults()}),this.attachResultHandlers();return}if(!this.query.trim()){e.innerHTML=`
                <div class="sm-empty" part="empty">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <p>Start typing to search</p>
                </div>
            `;return}if(this.results.length===0){e.innerHTML=`
                <div class="sm-empty" part="empty">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="m15 9-6 6M9 9l6 6"/>
                    </svg>
                    <p>No results for "<strong>${this.escapeHtml(this.query)}</strong>"</p>
                </div>
            `;return}if(r){let s=w(this.results),n=0;e.innerHTML=Object.entries(s).map(([o,a])=>`
                <div class="sm-section">
                    <div class="sm-section-header">${this.escapeHtml(o)}</div>
                    ${a.map(l=>this.renderResultItem(l,n++)).join("")}
                </div>
            `).join("")}else e.innerHTML=this.results.map((s,n)=>this.renderResultItem(s,n)).join("");this.attachResultHandlers()}renderResultItem(e,t){let r=e.title||e.name||"Untitled",s=e.description||e.excerpt||e.snippet||"",n=e.url||e.href||"#",o=e.section||e.type||"",a=this.highlightMatches(r,this.query),l=s?this.highlightMatches(s,this.query):"";return`
            <a class="sm-result-item" role="option" href="${this.escapeHtml(n)}" data-index="${t}" data-id="${e.id||""}" data-title="${this.escapeHtml(r)}">
                <div class="sm-result-content">
                    <span class="sm-result-title">${a}</span>
                    ${l?`<span class="sm-result-desc">${l}</span>`:""}
                </div>
                ${o&&!this.config.groupResults?`<span class="sm-result-type">${this.escapeHtml(o)}</span>`:""}
                <svg class="sm-result-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a>
        `}highlightMatches(e,t){if(!t)return this.escapeHtml(e);let r=this.escapeHtml(e);if(!this.config.enableHighlighting)return r;let s=t.toLowerCase().split(/\s+/).filter(g=>g.length>0),{highlightTag:n,highlightClass:o}=this.config,a=["sm-highlight"];o&&a.push(o);let l=` class="${a.join(" ")}"`,d=r;return s.forEach(g=>{let B=new RegExp(`\\b(${this.escapeRegex(g)})\\b`,"gi");d=d.replace(B,`<${n}${l}>$1</${n}>`)}),d}attachResultHandlers(){this.shadowRoot.querySelectorAll(".sm-result-item").forEach(t=>{t.addEventListener("click",r=>this.handleResultClick(r,t)),t.addEventListener("mouseenter",()=>{this.selectedIndex=parseInt(t.dataset.index)||0,this.updateSelection()})})}handleResultClick(e,t){let r=t.getAttribute("href")||t.dataset.url,s=t.dataset.title||t.querySelector(".sm-result-title")?.textContent,n=t.dataset.id,o=t.dataset.query||this.query;this.recentSearches=k(this.config.index,o,{title:s,url:r}),n&&this.config.index&&y({endpoint:this.config.analyticsEndpoint,elementId:n,query:o,index:this.config.index}),r&&r!=="#"?this.close():o&&(e.preventDefault(),this.elements.input.value=o,this.query=o,this.search(o))}open(){this.isOpen=!0,this.elements.backdrop.hidden=!1,this.elements.input.value="",this.query="",this.results=[],this.selectedIndex=-1,this.renderResults(),requestAnimationFrame(()=>{this.elements.input.focus()}),this.config.preventBodyScroll&&(document.body.style.overflow="hidden"),this.dispatchEvent(new CustomEvent("search-open"))}close(){this.isOpen=!1,this.elements.backdrop.hidden=!0,this.config.preventBodyScroll&&(document.body.style.overflow=""),this.dispatchEvent(new CustomEvent("search-close"))}toggle(){this.isOpen?this.close():this.open()}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};customElements.define("search-widget",h);var O=h;})();
