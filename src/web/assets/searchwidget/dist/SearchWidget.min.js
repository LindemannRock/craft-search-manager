(()=>{var k={modalBg:"#ffffff",modalBgDark:"#1f2937",modalBorderRadius:"12",modalBorderWidth:"1",modalBorderColor:"#e5e7eb",modalBorderColorDark:"#374151",modalShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",modalShadowDark:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",modalMaxWidth:"640",modalMaxHeight:"80",inputBg:"#ffffff",inputBgDark:"#1f2937",inputTextColor:"#111827",inputTextColorDark:"#f9fafb",inputPlaceholderColor:"#9ca3af",inputPlaceholderColorDark:"#9ca3af",inputBorderColor:"#e5e7eb",inputBorderColorDark:"#374151",inputFontSize:"16",resultBg:"transparent",resultBgDark:"transparent",resultHoverBg:"#f3f4f6",resultHoverBgDark:"#374151",resultActiveBg:"#e5e7eb",resultActiveBgDark:"#4b5563",resultTextColor:"#111827",resultTextColorDark:"#f9fafb",resultDescColor:"#4b5563",resultDescColorDark:"#d1d5db",resultMutedColor:"#6b7280",resultMutedColorDark:"#d1d5db",resultBorderRadius:"8",triggerBg:"#ffffff",triggerBgDark:"#374151",triggerTextColor:"#374151",triggerTextColorDark:"#d1d5db",triggerBorderRadius:"8",triggerBorderWidth:"1",triggerBorderColor:"#d1d5db",triggerBorderColorDark:"#4b5563",triggerPaddingX:"12",triggerPaddingY:"8",triggerFontSize:"14",kbdBg:"#f3f4f6",kbdBgDark:"#4b5563",kbdTextColor:"#4b5563",kbdTextColorDark:"#e5e7eb",kbdBorderRadius:"4"};var v={modalBg:"--sm-modal-bg",modalBgDark:"--sm-modal-bg-dark",modalBorderRadius:"--sm-modal-radius",modalBorderWidth:"--sm-modal-border-width",modalBorderColor:"--sm-modal-border-color",modalBorderColorDark:"--sm-modal-border-color-dark",modalShadow:"--sm-modal-shadow",modalShadowDark:"--sm-modal-shadow-dark",modalMaxWidth:"--sm-modal-width",modalMaxHeight:"--sm-modal-max-height",inputBg:"--sm-input-bg",inputBgDark:"--sm-input-bg-dark",inputTextColor:"--sm-input-color",inputTextColorDark:"--sm-input-color-dark",inputPlaceholderColor:"--sm-input-placeholder",inputPlaceholderColorDark:"--sm-input-placeholder-dark",inputBorderColor:"--sm-input-border-color",inputBorderColorDark:"--sm-input-border-color-dark",inputFontSize:"--sm-input-font-size",resultBg:"--sm-result-bg",resultBgDark:"--sm-result-bg-dark",resultHoverBg:"--sm-result-hover-bg",resultHoverBgDark:"--sm-result-hover-bg-dark",resultActiveBg:"--sm-result-active-bg",resultActiveBgDark:"--sm-result-active-bg-dark",resultTextColor:"--sm-result-text-color",resultTextColorDark:"--sm-result-text-color-dark",resultDescColor:"--sm-result-desc-color",resultDescColorDark:"--sm-result-desc-color-dark",resultMutedColor:"--sm-result-muted-color",resultMutedColorDark:"--sm-result-muted-color-dark",resultBorderRadius:"--sm-result-radius",triggerBg:"--sm-trigger-bg",triggerBgDark:"--sm-trigger-bg-dark",triggerTextColor:"--sm-trigger-text-color",triggerTextColorDark:"--sm-trigger-text-color-dark",triggerBorderRadius:"--sm-trigger-radius",triggerBorderWidth:"--sm-trigger-border-width",triggerBorderColor:"--sm-trigger-border-color",triggerBorderColorDark:"--sm-trigger-border-color-dark",triggerPaddingX:"--sm-trigger-px",triggerPaddingY:"--sm-trigger-py",triggerFontSize:"--sm-trigger-font-size",kbdBg:"--sm-kbd-bg",kbdBgDark:"--sm-kbd-bg-dark",kbdTextColor:"--sm-kbd-text-color",kbdTextColorDark:"--sm-kbd-text-color-dark",kbdBorderRadius:"--sm-kbd-radius",highlightBgLight:"--sm-highlight-bg",highlightColorLight:"--sm-highlight-color",highlightBgDark:"--sm-highlight-bg-dark",highlightColorDark:"--sm-highlight-color-dark"},y=["modalBorderRadius","modalBorderWidth","modalMaxWidth","inputFontSize","resultBorderRadius","triggerBorderRadius","triggerBorderWidth","triggerPaddingX","triggerPaddingY","triggerFontSize","kbdBorderRadius"],w=["modalMaxHeight"],C=["modalBg","modalBgDark","modalBorderColor","modalBorderColorDark","inputBg","inputBgDark","inputTextColor","inputTextColorDark","inputPlaceholderColor","inputPlaceholderColorDark","inputBorderColor","inputBorderColorDark","resultBg","resultBgDark","resultHoverBg","resultHoverBgDark","resultActiveBg","resultActiveBgDark","resultTextColor","resultTextColorDark","resultDescColor","resultDescColorDark","resultMutedColor","resultMutedColorDark","triggerBg","triggerBgDark","triggerTextColor","triggerTextColorDark","triggerBorderColor","triggerBorderColorDark","kbdBg","kbdBgDark","kbdTextColor","kbdTextColorDark","highlightBgLight","highlightColorLight","highlightBgDark","highlightColorDark"],W={...k,highlightBgLight:"#fef08a",highlightColorLight:"#854d0e",highlightBgDark:"#854d0e",highlightColorDark:"#fef08a"};function q(r){return/^[0-9a-fA-F]{6}$/.test(r)}function P(r,e){if(e==null||e==="")return null;let t=String(e);return C.includes(r)&&q(t)&&(t="#"+t),y.includes(r)&&(t=t+"px"),w.includes(r)&&(t=t+"vh"),t}function S(r,e,t="light"){if(!e||typeof e!="object")return;let n=t==="dark";for(let[s,o]of Object.entries(v)){let i=s.endsWith("Dark");if(!(n&&!i)&&!(!n&&i)&&e[s]!==void 0&&e[s]!==null&&e[s]!==""){let a=P(s,e[s]);a&&r.style.setProperty(o,a)}}}var z="sm-recent-";function b(r){return`${z}${r||"default"}`}function m(r){try{let e=b(r),t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}}function B(r,e,t=null,n=5){if(!e||!e.trim())return m(r);let s=b(r),o={query:e.trim(),title:t?.title||e,url:t?.url||null,timestamp:Date.now()},i=m(r);i=i.filter(a=>a.query!==o.query),i.unshift(o),i=i.slice(0,n);try{localStorage.setItem(s,JSON.stringify(i))}catch{}return i}function R(r){try{let e=b(r);localStorage.removeItem(e)}catch{}}async function D({query:r,endpoint:e,indices:t=[],siteId:n="",maxResults:s=10,hideResultsWithoutUrl:o=!1,signal:i}){let a=new URLSearchParams({q:r,limit:s.toString()});t.length>0&&a.append("indices",t.join(",")),n&&a.append("siteId",n),o&&a.append("hideResultsWithoutUrl","1");let l=e.includes("?")?"&":"?",d=await fetch(`${e}${l}${a}`,{signal:i,headers:{Accept:"application/json"}});if(!d.ok)throw new Error("Search failed");let c=await d.json();return{results:c.results||c.hits||[],total:c.total||0,meta:c.meta||null}}function A({endpoint:r,elementId:e,query:t,index:n}){if(!(!e||!r))try{let s=new FormData;s.append("elementId",e),s.append("query",t),s.append("index",n),fetch(r,{method:"POST",body:s}).catch(()=>{})}catch{}}function T(r){let e={};return r.forEach(t=>{let n=t.section||t.type||"Results";e[n]||(e[n]=[]),e[n].push(t)}),e}var N=0;function f(r="sm"){return`${r}-${++N}-${Date.now().toString(36)}`}function I(r){let e=document.createElement("div");return e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sm-sr-only",r.appendChild(e),e}function h(r,e,t=100){r&&(r.textContent="",setTimeout(()=>{r.textContent=e},t))}function x(r,e){return r===0?`No results found for "${e}"`:r===1?`1 result found for "${e}"`:`${r} results found for "${e}"`}function E(){return"Searching..."}function L(r){return r===0?"No recent searches":r===1?"1 recent search available":`${r} recent searches available`}function g(r,{expanded:e,activeDescendant:t,listboxId:n}){r.setAttribute("aria-expanded",String(e)),r.setAttribute("aria-controls",n),t?r.setAttribute("aria-activedescendant",t):r.removeAttribute("aria-activedescendant")}function u(r,e){return`${r}-option-${e}`}function M(r,e){if(!r||!e)return;let t=r.getBoundingClientRect(),n=e.getBoundingClientRect();t.top<n.top?r.scrollIntoView({block:"nearest",behavior:"smooth"}):t.bottom>n.bottom&&r.scrollIntoView({block:"nearest",behavior:"smooth"})}var $=`/**
 * Search Widget Styles (Combined)
 *
 * Combined stylesheet for the modal search widget.
 * This file is used by the legacy SearchWidget.js for backward compatibility.
 *
 * For the refactored architecture, styles are split into:
 * - base.css: Shared styles for all widget types
 * - modal.css: Modal-specific styles
 *
 * The new SearchModalWidget.js imports and concatenates both files.
 *
 * @module styles/SearchWidget
 * @author Search Manager
 * @since 5.x
 */

/* =========================================================================
   HOST & RESET
   ========================================================================= */

:host {
    /* Modal defaults - inline styles from config will override same-name vars */
    --sm-modal-bg: #ffffff;
    --sm-modal-border: var(--sm-modal-border-color, #e5e7eb);
    --sm-modal-border-width: 1px;
    --sm-modal-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --sm-modal-radius: 12px;
    --sm-modal-width: 640px;
    --sm-modal-max-height: 80vh;

    /* Input defaults */
    --sm-input-bg: #ffffff;
    --sm-input-color: #111827;
    --sm-input-placeholder: #9ca3af;
    --sm-input-font-size: 16px;

    /* Text colors - map from config variable names */
    /* Color contrast ratios meet WCAG 2.1 AA (4.5:1 for normal text) */
    --sm-text-primary: var(--sm-result-text-color, #111827);
    --sm-text-secondary: var(--sm-result-desc-color, #4b5563);
    --sm-text-muted: var(--sm-result-muted-color, #6b7280);

    /* Borders and backgrounds - map from config variable names */
    --sm-border-color: var(--sm-input-border-color, #e5e7eb);
    --sm-hover-bg: var(--sm-result-hover-bg, #f3f4f6);
    --sm-selected-bg: var(--sm-result-active-bg, #e5e7eb);
    --sm-selected-border: #3b82f6;
    --sm-result-radius: 8px;

    /* Highlighting */
    --sm-highlight-bg: #fef08a;
    --sm-highlight-color: #854d0e;

    /* Kbd / keyboard shortcuts - 4.5:1 contrast ratio minimum */
    --sm-kbd-bg: #f3f4f6;
    --sm-kbd-border: #d1d5db;
    --sm-kbd-color: var(--sm-kbd-text-color, #4b5563);
    --sm-kbd-radius: 4px;

    /* Trigger button */
    --sm-trigger-bg: #ffffff;
    --sm-trigger-color: var(--sm-trigger-text-color, #374151);
    --sm-trigger-border: var(--sm-trigger-border-color, #d1d5db);
    --sm-trigger-radius: 8px;
    --sm-trigger-border-width: 1px;
    --sm-trigger-px: 12px;
    --sm-trigger-py: 8px;
    --sm-trigger-font-size: 14px;

    /* Accent colors */
    --sm-accent: #3b82f6;
    --sm-accent-hover: #2563eb;

    display: inline-block;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

/* Dark theme - uses custom dark variables with fallbacks */
/* Color contrast ratios meet WCAG 2.1 AA (4.5:1 for normal text, 3:1 for large text) */
:host([data-theme="dark"]) {
    --sm-modal-bg: var(--sm-modal-bg-dark, #1f2937);
    --sm-modal-border: var(--sm-modal-border-color-dark, #374151);

    --sm-input-bg: var(--sm-input-bg-dark, #1f2937);
    --sm-input-color: var(--sm-input-color-dark, #f9fafb);
    --sm-input-placeholder: var(--sm-input-placeholder-dark, #9ca3af);

    --sm-text-primary: var(--sm-result-text-color-dark, #f9fafb);
    --sm-text-secondary: var(--sm-result-desc-color-dark, #d1d5db);
    --sm-text-muted: var(--sm-result-muted-color-dark, #9ca3af);

    --sm-border-color: var(--sm-input-border-color-dark, #374151);
    --sm-hover-bg: var(--sm-result-hover-bg-dark, #374151);
    --sm-selected-bg: var(--sm-result-active-bg-dark, #4b5563);
    --sm-selected-border: #3b82f6;

    --sm-highlight-bg: var(--sm-highlight-bg-dark, #854d0e);
    --sm-highlight-color: var(--sm-highlight-color-dark, #fef08a);

    --sm-kbd-bg: var(--sm-kbd-bg-dark, #374151);
    --sm-kbd-border: #4b5563;
    --sm-kbd-color: var(--sm-kbd-text-color-dark, #e5e7eb);

    --sm-trigger-bg: var(--sm-trigger-bg-dark, #374151);
    --sm-trigger-color: var(--sm-trigger-text-color-dark, #e5e7eb);
    --sm-trigger-border: var(--sm-trigger-border-color-dark, #4b5563);
}

*, *::before, *::after {
    box-sizing: border-box;
}

/* =========================================================================
   TRIGGER BUTTON
   ========================================================================= */

.sm-trigger {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: var(--sm-trigger-py) var(--sm-trigger-px);
    background: var(--sm-trigger-bg);
    border: var(--sm-trigger-border-width) solid var(--sm-trigger-border);
    border-radius: var(--sm-trigger-radius);
    color: var(--sm-trigger-color);
    font-size: var(--sm-trigger-font-size);
    cursor: pointer;
    transition: all 0.15s ease;
}

.sm-trigger:hover {
    border-color: var(--sm-accent);
    color: var(--sm-text-primary);
}

.sm-trigger-kbd {
    display: inline-flex;
    align-items: center;
    padding: 2px 6px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

/* =========================================================================
   BACKDROP
   ========================================================================= */

.sm-backdrop {
    position: fixed;
    inset: 0;
    z-index: 99999;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 10vh;
    background: rgba(0, 0, 0, var(--sm-backdrop-opacity, 0.5));
    backdrop-filter: var(--sm-backdrop-blur, blur(4px));
    animation: sm-fade-in 0.15s ease;
}

.sm-backdrop[hidden] {
    display: none;
}

@keyframes sm-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* =========================================================================
   MODAL CONTAINER
   ========================================================================= */

.sm-modal {
    width: var(--sm-modal-width);
    max-width: calc(100vw - 32px);
    max-height: var(--sm-modal-max-height);
    background: var(--sm-modal-bg);
    border: var(--sm-modal-border-width, 1px) solid var(--sm-modal-border);
    border-radius: var(--sm-modal-radius);
    box-shadow: var(--sm-modal-shadow);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: sm-slide-up 0.2s ease;
}

@keyframes sm-slide-up {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* =========================================================================
   MODAL HEADER
   ========================================================================= */

.sm-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-bottom: 1px solid var(--sm-border-color);
}

.sm-search-icon {
    flex-shrink: 0;
    color: var(--sm-text-muted);
}

.sm-input {
    flex: 1;
    border: none;
    background: var(--sm-input-bg);
    color: var(--sm-input-color);
    font-size: var(--sm-input-font-size);
    outline: none;
}

.sm-input::placeholder {
    color: var(--sm-input-placeholder);
}

.sm-loading {
    flex-shrink: 0;
}

.sm-spinner {
    animation: sm-spin 1s linear infinite;
    color: var(--sm-accent);
}

@keyframes sm-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.sm-close {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 4px 8px;
    background: transparent;
    border: none;
    cursor: pointer;
}

.sm-close kbd {
    padding: 2px 6px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

/* =========================================================================
   RESULTS CONTAINER
   ========================================================================= */

.sm-results {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

/* =========================================================================
   SECTION GROUPING
   ========================================================================= */

.sm-section {
    margin-bottom: 8px;
}

.sm-section:last-child {
    margin-bottom: 0;
}

.sm-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--sm-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.sm-clear-recent {
    padding: 2px 8px;
    background: transparent;
    border: none;
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    color: var(--sm-text-muted);
    cursor: pointer;
    text-transform: none;
    letter-spacing: normal;
}

.sm-clear-recent:hover {
    background: var(--sm-hover-bg);
    color: var(--sm-text-secondary);
}

/* =========================================================================
   RESULT ITEM
   ========================================================================= */

.sm-result-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: var(--sm-result-radius);
    color: var(--sm-text-primary);
    text-decoration: none;
    cursor: pointer;
    transition: background 0.1s ease;
}

.sm-result-item:hover,
.sm-result-item.sm-selected {
    background: var(--sm-hover-bg);
}

.sm-result-item.sm-selected {
    background: var(--sm-selected-bg);
    outline: 2px solid var(--sm-selected-border);
    outline-offset: -2px;
}

.sm-result-icon {
    flex-shrink: 0;
    color: var(--sm-text-muted);
}

.sm-result-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sm-result-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--sm-text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.sm-result-desc {
    font-size: 13px;
    color: var(--sm-text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.sm-result-type {
    flex-shrink: 0;
    padding: 2px 8px;
    background: var(--sm-kbd-bg);
    border-radius: var(--sm-kbd-radius);
    font-size: 11px;
    color: var(--sm-text-muted);
}

.sm-result-arrow {
    flex-shrink: 0;
    color: var(--sm-text-muted);
    opacity: 0;
    transition: opacity 0.1s ease;
}

.sm-result-item:hover .sm-result-arrow,
.sm-result-item.sm-selected .sm-result-arrow {
    opacity: 1;
}

/* =========================================================================
   PROMOTED RESULTS
   ========================================================================= */

.sm-result-item.sm-promoted {
    position: relative;
}

.sm-promoted-badge {
    position: absolute;
    padding: 2px 6px;
    background: var(--sm-accent);
    color: #ffffff;
    font-size: 10px;
    font-weight: 600;
    border-radius: var(--sm-kbd-radius);
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.sm-promoted-badge--top-right {
    top: 4px;
    right: 4px;
}

.sm-promoted-badge--top-left {
    top: 4px;
    left: 4px;
}

.sm-promoted-badge--inline {
    position: static;
    margin-left: 8px;
}

/* =========================================================================
   HIGHLIGHTING
   ========================================================================= */

/* Uses .sm-highlight class to work with any tag (mark, span, etc.) */
.sm-highlight {
    background: var(--sm-highlight-bg);
    color: var(--sm-highlight-color);
    border-radius: 2px;
    padding: 0 2px;
}

/* =========================================================================
   EMPTY STATE
   ========================================================================= */

.sm-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 48px 24px;
    color: var(--sm-text-muted);
    text-align: center;
}

.sm-empty p {
    margin: 0;
    font-size: 14px;
}

.sm-empty strong {
    color: var(--sm-text-secondary);
}

/* =========================================================================
   LOADING STATE
   ========================================================================= */

.sm-loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 48px 24px;
    color: var(--sm-text-muted);
    text-align: center;
}

.sm-loading-state p {
    margin: 0;
    font-size: 14px;
}

/* =========================================================================
   MODAL FOOTER
   ========================================================================= */

.sm-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 12px 16px;
    border-top: 1px solid var(--sm-border-color);
    font-size: 12px;
    color: var(--sm-text-muted);
}

.sm-footer-hints {
    display: flex;
    align-items: center;
    gap: 12px;
}

.sm-footer-hints span {
    display: flex;
    align-items: center;
    gap: 4px;
}

.sm-footer kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    padding: 2px 4px;
    background: var(--sm-kbd-bg);
    border: 1px solid var(--sm-kbd-border);
    border-radius: var(--sm-kbd-radius);
    font-size: 10px;
    font-family: inherit;
    color: var(--sm-kbd-color);
}

.sm-footer-brand {
    color: var(--sm-text-muted);
}

.sm-footer-brand strong {
    color: var(--sm-text-secondary);
}

/* =========================================================================
   RTL SUPPORT
   ========================================================================= */

:host([dir="rtl"]) .sm-header,
:host([dir="rtl"]) .sm-result-item,
:host([dir="rtl"]) .sm-footer {
    direction: rtl;
}

:host([dir="rtl"]) .sm-result-arrow {
    transform: scaleX(-1);
}

/* =========================================================================
   ACCESSIBILITY
   ========================================================================= */

/* Screen reader only - visually hidden but accessible */
.sm-sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* =========================================================================
   MOBILE RESPONSIVE
   ========================================================================= */

@media (max-width: 640px) {
    .sm-backdrop {
        padding-top: 0;
        align-items: flex-end;
    }

    .sm-modal {
        max-width: 100%;
        max-height: 90vh;
        border-radius: var(--sm-modal-radius) var(--sm-modal-radius) 0 0;
    }

    .sm-trigger-text,
    .sm-footer-hints {
        display: none;
    }
}
`;var p=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.isOpen=!1,this.results=[],this.recentSearches=[],this.selectedIndex=-1,this.loading=!1,this.query="",this.debounceTimer=null,this.abortController=null,this.listboxId=f("sm-listbox"),this.inputId=f("sm-input"),this.liveRegion=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleGlobalKeydown=this.handleGlobalKeydown.bind(this),this.handleInput=this.handleInput.bind(this),this.handleResultClick=this.handleResultClick.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this)}static get observedAttributes(){return["indices","placeholder","endpoint","theme","max-results","debounce","min-chars","show-recent","group-results","hotkey","site-id","enable-highlighting","highlight-tag","highlight-class","backdrop-opacity","enable-backdrop-blur","prevent-body-scroll","show-trigger","trigger-selector","styles","hide-results-without-url"]}get styles(){let e=this.getAttribute("styles");if(e)try{return JSON.parse(e)}catch(t){console.warn("SearchWidget: Invalid styles JSON",t)}return{}}get config(){let e=this.getAttribute("indices")||"",t=e?e.split(",").map(n=>n.trim()).filter(Boolean):[];return{indices:t,index:t[0]||"",placeholder:this.getAttribute("placeholder")||"Search...",endpoint:this.getAttribute("endpoint")||"/actions/search-manager/search/query",theme:this.getAttribute("theme")||"light",maxResults:parseInt(this.getAttribute("max-results"))||10,debounce:parseInt(this.getAttribute("debounce"))||200,minChars:parseInt(this.getAttribute("min-chars"))||2,showRecent:this.getAttribute("show-recent")!=="false",maxRecentSearches:parseInt(this.getAttribute("max-recent-searches"))||5,groupResults:this.getAttribute("group-results")!=="false",hotkey:this.getAttribute("hotkey")||"k",siteId:this.getAttribute("site-id")||"",analyticsEndpoint:this.getAttribute("analytics-endpoint")||"/actions/search-manager/search/track-click",enableHighlighting:this.getAttribute("enable-highlighting")!=="false",highlightTag:this.getAttribute("highlight-tag")||"mark",highlightClass:this.getAttribute("highlight-class")||"",backdropOpacity:parseInt(this.getAttribute("backdrop-opacity"))||50,enableBackdropBlur:this.getAttribute("enable-backdrop-blur")!=="false",preventBodyScroll:this.getAttribute("prevent-body-scroll")!=="false",showTrigger:this.getAttribute("show-trigger")!=="false",triggerSelector:this.getAttribute("trigger-selector")||"",hideResultsWithoutUrl:this.getAttribute("hide-results-without-url")==="true"}}connectedCallback(){this.render(),this.recentSearches=m(this.config.index),this.attachEventListeners()}disconnectedCallback(){this.detachEventListeners()}attributeChangedCallback(e,t,n){t!==n&&this.shadowRoot.querySelector(".sm-modal")&&this.render()}render(){let{theme:e,placeholder:t,showTrigger:n}=this.config;this.shadowRoot.innerHTML=`
            <style>${$}</style>

            <!-- Trigger button -->
            <button class="sm-trigger" part="trigger" aria-label="Open search" ${n?"":'style="display: none;"'}>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <span class="sm-trigger-text">Search</span>
                <kbd class="sm-trigger-kbd" aria-hidden="true">${this.getHotkeyDisplay()}</kbd>
            </button>

            <!-- Modal backdrop -->
            <div class="sm-backdrop" part="backdrop" hidden>
                <div class="sm-modal" part="modal" role="dialog" aria-modal="true" aria-label="Search">
                    <!-- Search input -->
                    <div class="sm-header" part="header">
                        <svg class="sm-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input
                            type="text"
                            id="${this.inputId}"
                            class="sm-input"
                            part="input"
                            placeholder="${t}"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off"
                            spellcheck="false"
                            role="combobox"
                            aria-autocomplete="list"
                            aria-haspopup="listbox"
                            aria-expanded="false"
                            aria-controls="${this.listboxId}"
                        />
                        <div class="sm-loading" part="loading" hidden>
                            <svg class="sm-spinner" width="20" height="20" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" opacity="0.25"/>
                                <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <button class="sm-close" part="close" aria-label="Close search">
                            <kbd>esc</kbd>
                        </button>
                    </div>

                    <!-- Results -->
                    <div class="sm-results" part="results" id="${this.listboxId}" role="listbox" aria-label="Search results"></div>

                    <!-- Footer -->
                    <div class="sm-footer" part="footer">
                        <div class="sm-footer-hints">
                            <span><kbd>\u2191</kbd><kbd>\u2193</kbd> navigate</span>
                            <span><kbd>\u21B5</kbd> select</span>
                            <span><kbd>esc</kbd> close</span>
                        </div>
                        <div class="sm-footer-brand">
                            Powered by <strong>Search Manager</strong>
                        </div>
                    </div>
                </div>
            </div>
        `,this.elements={trigger:this.shadowRoot.querySelector(".sm-trigger"),backdrop:this.shadowRoot.querySelector(".sm-backdrop"),modal:this.shadowRoot.querySelector(".sm-modal"),input:this.shadowRoot.querySelector(".sm-input"),results:this.shadowRoot.querySelector(".sm-results"),loading:this.shadowRoot.querySelector(".sm-loading"),close:this.shadowRoot.querySelector(".sm-close")},this.liveRegion=I(this.shadowRoot),this.shadowRoot.host.setAttribute("data-theme",e),this.applyCustomStyles()}applyCustomStyles(){let{backdropOpacity:e,enableBackdropBlur:t,theme:n}=this.config,s=this.shadowRoot.host;s.style.setProperty("--sm-backdrop-opacity",e/100),s.style.setProperty("--sm-backdrop-blur",t?"blur(4px)":"none"),S(s,this.styles,n)}getHotkeyDisplay(){let e=navigator.platform.toUpperCase().indexOf("MAC")>=0,t=this.config.hotkey.toUpperCase();return e?`\u2318${t}`:`Ctrl+${t}`}attachEventListeners(){this.elements.trigger.addEventListener("click",this.toggle),this.elements.close.addEventListener("click",this.close),this.elements.backdrop.addEventListener("click",this.handleBackdropClick),this.elements.input.addEventListener("input",this.handleInput),this.elements.input.addEventListener("keydown",this.handleKeydown),document.addEventListener("keydown",this.handleGlobalKeydown);let{triggerSelector:e}=this.config;e&&(this.externalTrigger=document.querySelector(e),this.externalTrigger&&this.externalTrigger.addEventListener("click",this.toggle))}detachEventListeners(){document.removeEventListener("keydown",this.handleGlobalKeydown),this.externalTrigger&&(this.externalTrigger.removeEventListener("click",this.toggle),this.externalTrigger=null)}handleGlobalKeydown(e){let t=this.config.hotkey.toLowerCase();(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&e.key.toLowerCase()===t&&(e.preventDefault(),this.toggle()),e.key==="Escape"&&this.isOpen&&(e.preventDefault(),this.close())}handleKeydown(e){let t=this.shadowRoot.querySelectorAll(".sm-result-item"),n=t.length;switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,n-1),this.updateSelection();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelection();break;case"Enter":e.preventDefault(),this.selectedIndex>=0&&t[this.selectedIndex]&&t[this.selectedIndex].click();break;case"Escape":e.preventDefault(),this.close();break}}updateSelection(){let e=this.shadowRoot.querySelectorAll(".sm-result-item"),t=this.selectedIndex>=0?u(this.listboxId,this.selectedIndex):null;g(this.elements.input,{expanded:e.length>0,activeDescendant:t,listboxId:this.listboxId}),e.forEach((n,s)=>{let o=s===this.selectedIndex;n.classList.toggle("sm-selected",o),n.setAttribute("aria-selected",String(o)),o&&M(n,this.elements.results)})}handleBackdropClick(e){e.target===this.elements.backdrop&&this.close()}handleInput(e){if(this.query=e.target.value,this.selectedIndex=-1,this.debounceTimer&&clearTimeout(this.debounceTimer),!this.query.trim()){this.results=[],this.renderResults();return}this.query.length<this.config.minChars||(this.debounceTimer=setTimeout(()=>{this.search(this.query)},this.config.debounce))}async search(e){this.abortController&&this.abortController.abort(),this.abortController=new AbortController,this.loading=!0,this.elements.loading.hidden=!1,h(this.liveRegion,E());try{this.results=await D({query:e,endpoint:this.config.endpoint,indices:this.config.indices,siteId:this.config.siteId,maxResults:this.config.maxResults,hideResultsWithoutUrl:this.config.hideResultsWithoutUrl,signal:this.abortController.signal}),this.renderResults()}catch(t){t.name!=="AbortError"&&(console.error("Search error:",t),this.results=[],this.renderResults())}finally{this.loading=!1,this.elements.loading.hidden=!0}}renderResults(){let e=this.elements.results,{showRecent:t,groupResults:n}=this.config;if(!this.query.trim()&&t&&this.recentSearches.length>0){e.innerHTML=`
                <div class="sm-section">
                    <div class="sm-section-header">
                        <span id="${this.listboxId}-recent-label">Recent searches</span>
                        <button class="sm-clear-recent" part="clear-recent">Clear</button>
                    </div>
                    ${this.recentSearches.map((o,i)=>`
                        <div class="sm-result-item sm-recent-item" id="${u(this.listboxId,i)}" role="option" aria-selected="false" data-index="${i}" data-url="${o.url||""}" data-query="${this.escapeHtml(o.query)}">
                            <svg class="sm-result-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span class="sm-result-title">${this.escapeHtml(o.title||o.query)}</span>
                            <svg class="sm-result-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </div>
                    `).join("")}
                </div>
            `,h(this.liveRegion,L(this.recentSearches.length));let s=e.querySelector(".sm-clear-recent");s&&s.addEventListener("click",o=>{o.stopPropagation(),R(this.config.index),this.recentSearches=[],this.renderResults()}),this.attachResultHandlers();return}if(!this.query.trim()){e.removeAttribute("role"),e.innerHTML=`
                <div class="sm-empty" part="empty">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <p>Start typing to search</p>
                </div>
            `,g(this.elements.input,{expanded:!1,activeDescendant:null,listboxId:this.listboxId});return}if(this.results.length===0){e.removeAttribute("role"),e.innerHTML=`
                <div class="sm-empty" part="empty">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="m15 9-6 6M9 9l6 6"/>
                    </svg>
                    <p>No results for "<strong>${this.escapeHtml(this.query)}</strong>"</p>
                </div>
            `,h(this.liveRegion,x(0,this.query)),g(this.elements.input,{expanded:!1,activeDescendant:null,listboxId:this.listboxId});return}if(e.setAttribute("role","listbox"),n){let s=T(this.results),o=0;e.innerHTML=Object.entries(s).map(([i,a])=>`
                <div class="sm-section" role="group" aria-label="${this.escapeHtml(i)}">
                    <div class="sm-section-header">${this.escapeHtml(i)}</div>
                    ${a.map(l=>this.renderResultItem(l,o++)).join("")}
                </div>
            `).join("")}else e.innerHTML=this.results.map((s,o)=>this.renderResultItem(s,o)).join("");h(this.liveRegion,x(this.results.length,this.query)),g(this.elements.input,{expanded:!0,activeDescendant:null,listboxId:this.listboxId}),this.results.length>0&&(this.selectedIndex=0,this.updateSelection()),this.attachResultHandlers()}renderResultItem(e,t){let n=e.title||e.name||"Untitled",s=e.description||e.excerpt||e.snippet||"",o=e.url||e.href||"#",i=e.section||e.type||"",a=u(this.listboxId,t),l=this.highlightMatches(n,this.query),d=s?this.highlightMatches(s,this.query):"";return`
            <a class="sm-result-item" id="${a}" role="option" aria-selected="false" href="${this.escapeHtml(o)}" data-index="${t}" data-id="${e.id||""}" data-title="${this.escapeHtml(n)}">
                <div class="sm-result-content">
                    <span class="sm-result-title">${l}</span>
                    ${d?`<span class="sm-result-desc">${d}</span>`:""}
                </div>
                ${i&&!this.config.groupResults?`<span class="sm-result-type">${this.escapeHtml(i)}</span>`:""}
                <svg class="sm-result-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a>
        `}highlightMatches(e,t){if(!t)return this.escapeHtml(e);let n=this.escapeHtml(e);if(!this.config.enableHighlighting)return n;let s=t.toLowerCase().split(/\s+/).filter(c=>c.length>0),{highlightTag:o,highlightClass:i}=this.config,a=["sm-highlight"];i&&a.push(i);let l=` class="${a.join(" ")}"`,d=n;return s.forEach(c=>{let H=new RegExp(`\\b(${this.escapeRegex(c)})\\b`,"gi");d=d.replace(H,`<${o}${l}>$1</${o}>`)}),d}attachResultHandlers(){this.shadowRoot.querySelectorAll(".sm-result-item").forEach(t=>{t.addEventListener("click",n=>this.handleResultClick(n,t)),t.addEventListener("mouseenter",()=>{this.selectedIndex=parseInt(t.dataset.index)||0,this.updateSelection()})})}handleResultClick(e,t){let n=t.getAttribute("href"),s=t.dataset.url,o=n||s,i=t.dataset.title||t.querySelector(".sm-result-title")?.textContent,a=t.dataset.id,l=t.dataset.query||this.query,d=t.classList.contains("sm-recent-item");d||(this.recentSearches=B(this.config.index,l,{title:i,url:o},this.config.maxRecentSearches)),a&&this.config.index&&A({endpoint:this.config.analyticsEndpoint,elementId:a,query:l,index:this.config.index}),o&&o!=="#"?(d&&(e.preventDefault(),window.location.href=o),this.close()):l&&(e.preventDefault(),this.elements.input.value=l,this.query=l,this.search(l))}open(){this.isOpen=!0,this.elements.backdrop.hidden=!1,this.elements.input.value="",this.query="",this.results=[],this.selectedIndex=-1,this.renderResults(),requestAnimationFrame(()=>{this.elements.input.focus()}),this.config.preventBodyScroll&&(document.body.style.overflow="hidden"),this.dispatchEvent(new CustomEvent("search-open"))}close(){this.isOpen=!1,this.elements.backdrop.hidden=!0,this.config.preventBodyScroll&&(document.body.style.overflow=""),this.dispatchEvent(new CustomEvent("search-close"))}toggle(){this.isOpen?this.close():this.open()}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};customElements.define("search-widget",p);var re=p;})();
