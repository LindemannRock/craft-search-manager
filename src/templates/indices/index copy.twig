{% extends "_layouts/cp" %}
{% set title = "Indices"|t('search-manager') %}
{% set selectedSubnavItem = 'indices' %}

{% block actionButton %}
    {% if currentUser.can('searchManager:createIndices') %}
        <a href="{{ url('search-manager/indices/create') }}" class="btn submit add icon">{{ "New Index"|t('search-manager') }}</a>
    {% endif %}
{% endblock %}

{% block content %}

{% if indices %}
    <table class="data fullwidth">
        <thead>
            <tr>
                <th>{{ "Name"|t('search-manager') }}</th>
                <th>{{ "Handle"|t('search-manager') }}</th>
                <th>{{ "Element Type"|t('search-manager') }}</th>
                <th>{{ "Backend"|t('search-manager') }}</th>
                <th>{{ "Documents"|t('search-manager') }}</th>
                <th>{{ "Last Indexed"|t('search-manager') }}</th>
                <th>{{ "Config Source"|t('search-manager') }}</th>
                <th>{{ "Status"|t('search-manager') }}</th>
                <th class="thin"></th>
            </tr>
        </thead>
        <tbody>
            {% for index in indices %}
                <tr data-id="{{ index.id }}" data-name="{{ index.name }}">
                    <td>
                        {% if index.canEdit() %}
                            <a href="{{ url('search-manager/indices/edit/' ~ index.id) }}">
                                {{ index.name }}
                            </a>
                        {% else %}
                            {{ index.name }}
                            <span class="info">{{ "(Config)"|t('search-manager') }}</span>
                        {% endif %}
                    </td>
                    <td><code>{{ index.handle }}</code></td>
                    <td>{{ index.elementType|split('\\')|last }}</td>
                    <td><span class="status" style="background: #0ea5e9;"></span> {{ craft.searchManager.settings.searchBackend|title }}</td>
                    <td>{{ index.documentCount }}</td>
                    <td>
                        {% if index.lastIndexed %}
                            {{ index.lastIndexed|datetime('short') }}
                        {% else %}
                            <span class="light">{{ "Never"|t('search-manager') }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if index.source == 'config' %}
                            <span class="status blue"></span> {{ "Config"|t('search-manager') }}
                        {% else %}
                            <span class="status green"></span> {{ "Database"|t('search-manager') }}
                        {% endif %}
                    </td>
                    <td>
                        {% if index.enabled %}
                            <span class="status green"></span>
                        {% else %}
                            <span class="status"></span>
                        {% endif %}
                    </td>
                    <td class="thin">
                        <div class="btngroup">
                            {% if currentUser.can('searchManager:rebuildIndices') %}
                                <form method="post" accept-charset="UTF-8">
                                    {{ actionInput('search-manager/indices/rebuild') }}
                                    {{ csrfInput() }}
                                    {{ hiddenInput('indexId', index.id) }}
                                    <button type="submit" class="btn small" title="{{ 'Rebuild'|t('search-manager') }}">
                                        {{ "Rebuild"|t('search-manager') }}
                                    </button>
                                </form>
                            {% endif %}

                            {% if currentUser.can('searchManager:deleteIndices') and index.canEdit() %}
                                <form method="post" accept-charset="UTF-8">
                                    {{ actionInput('search-manager/indices/delete') }}
                                    {{ csrfInput() }}
                                    {{ hiddenInput('indexId', index.id) }}
                                    <button type="submit" class="btn small" title="{{ 'Delete'|t('search-manager') }}"
                                            onclick="return confirm('{{ 'Are you sure you want to delete this index?'|t('search-manager') }}')">
                                        {{ "Delete"|t('search-manager') }}
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="light">{{ "No indices found."|t('search-manager') }}</p>
    {% if currentUser.can('searchManager:createIndices') %}
        <div class="buttons">
            <a href="{{ url('search-manager/indices/create') }}" class="btn submit add icon">{{ "Create an Index"|t('search-manager') }}</a>
        </div>
    {% endif %}
{% endif %}

{% endblock %}
