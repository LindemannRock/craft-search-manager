{#
 # Index Listing Macros
 #
 # Reusable macros for index listing pages (backends, indices, widgets).
 # Colors are built-in - no need to pass them as parameters.
 #
 # Usage:
 #   {% import 'search-manager/_macros/index' as indexMacros %}
 #   {{ indexMacros.sourceBadge('config') }}
 #   {{ indexMacros.backendBadge('typesense') }}
 #}

{# =========================================================================
   SOURCE BADGE
   Renders Config/Database source badge with built-in colors

   @param string source - 'config' or 'database'
   ========================================================================= #}

{% macro sourceBadge(source) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}
	{% set rgb = {
		'config': '245, 158, 11',
		'database': '59, 130, 246',
	} %}
	{% set textColors = {
		'config': '#78350f',
		'database': '#1e3a8a',
	} %}

	{% if source == 'config' %}
		<span class="status-label" style="background: rgba({{ rgb.config }}, 0.12);"><span class="status" style="background: {{ colors.config }};"></span><span class="status-label-text" style="color: {{ textColors.config }};">{{ "Config"|t('search-manager') }}</span></span>
	{% else %}
		<span class="status-label" style="background: rgba({{ rgb.database }}, 0.12);"><span class="status" style="background: {{ colors.database }};"></span><span class="status-label-text" style="color: {{ textColors.database }};">{{ "Database"|t('search-manager') }}</span></span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   STATUS BADGE
   Renders Enabled/Disabled status badge

   @param bool enabled - true for enabled, false for disabled
   ========================================================================= #}

{% macro statusBadge(enabled) %}
	{% if enabled %}
		<span class="status-label teal"><span class="status teal"></span><span class="status-label-text">{{ 'Enabled'|t('search-manager') }}</span></span>
	{% else %}
		<span class="status-label gray"><span class="status disabled"></span><span class="status-label-text">{{ 'Disabled'|t('search-manager') }}</span></span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   BACKEND TYPE BADGE
   Renders backend type badge (MySQL, Typesense, etc.) with built-in colors

   @param string backendType - 'mysql', 'typesense', 'algolia', etc.
   @param string|null label - Optional custom label (defaults to uppercase backendType)
   ========================================================================= #}

{% macro backendBadge(backendType, label) %}
	{% set colors = {
		'mysql': '#f59e0b',
		'pgsql': '#3b82f6',
		'file': '#6b7280',
		'redis': '#dc2626',
		'typesense': '#8b5cf6',
		'algolia': '#06b6d4',
		'meilisearch': '#ec4899',
		'elasticsearch': '#fec514',
	} %}
	{% set rgb = {
		'mysql': '245, 158, 11',
		'pgsql': '59, 130, 246',
		'file': '107, 114, 128',
		'redis': '220, 38, 38',
		'typesense': '139, 92, 246',
		'algolia': '6, 182, 212',
		'meilisearch': '236, 72, 153',
		'elasticsearch': '254, 197, 20',
	} %}
	{% set textColors = {
		'mysql': '#78350f',
		'pgsql': '#1e3a8a',
		'file': '#374151',
		'redis': '#7f1d1d',
		'typesense': '#5b21b6',
		'algolia': '#155e75',
		'meilisearch': '#831843',
		'elasticsearch': '#713f12',
	} %}

	{% set bColor = colors[backendType]|default('#9aa5b1') %}
	{% set bRgb = rgb[backendType]|default('154, 165, 177') %}
	{% set bTextColor = textColors[backendType]|default('#374151') %}
	{% set displayLabel = label|default(backendType|upper) %}

	{% if backendType %}
		<span class="status-label" style="background: rgba({{ bRgb }}, 0.12); white-space: nowrap;">
			<span class="status" style="background: {{ bColor }};"></span>
			<span class="status-label-text" style="color: {{ bTextColor }};">{{ displayLabel }}</span>
		</span>
	{% else %}
		<span class="light">—</span>
	{% endif %}
{% endmacro %}

{# =========================================================================
   SOURCE FILTER MENU ITEMS
   Renders the Config Source filter section for dropdown menus

   @param string sourceFilter - current filter value ('all', 'config', 'database')
   @param string statusFilter - current status filter
   @param string search - current search query
   @param object extraParams - additional URL params { key: value }
   ========================================================================= #}

{% macro sourceFilterMenu(sourceFilter, statusFilter, search, extraParams) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}

	<li><hr class="padded"></li>
	<li class="menu-header">{{ 'Config Source'|t('search-manager') }}</li>
	<li>
		<a class="{{ sourceFilter == 'all' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=all{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status all"></span>{{ 'All Sources'|t('search-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ sourceFilter == 'config' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=config{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status" style="background: {{ sourceFilter == 'config' ? colors.config : '#aab6c1' }};"></span>{{ 'Config File'|t('search-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ sourceFilter == 'database' ? 'sel' : '' }}" href="?status={{ statusFilter }}&source=database{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status" style="background: {{ sourceFilter == 'database' ? colors.database : '#aab6c1' }};"></span>{{ 'Database'|t('search-manager') }}
		</a>
	</li>
{% endmacro %}

{# =========================================================================
   STATUS FILTER MENU ITEMS
   Renders the Status filter section for dropdown menus

   @param string statusFilter - current filter value ('all', 'enabled', 'disabled')
   @param string sourceFilter - current source filter
   @param string search - current search query
   @param object extraParams - additional URL params { key: value }
   ========================================================================= #}

{% macro statusFilterMenu(statusFilter, sourceFilter, search, extraParams) %}
	<li>
		<a class="{{ statusFilter == 'all' ? 'sel' : '' }}" href="?status=all&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status all"></span>{{ 'All'|t('search-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ statusFilter == 'enabled' ? 'sel' : '' }}" href="?status=enabled&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status green"></span>{{ 'Enabled'|t('search-manager') }}
		</a>
	</li>
	<li>
		<a class="{{ statusFilter == 'disabled' ? 'sel' : '' }}" href="?status=disabled&source={{ sourceFilter }}{% for key, value in extraParams %}&{{ key }}={{ value }}{% endfor %}&search={{ search }}">
			<span class="status disabled"></span>{{ 'Disabled'|t('search-manager') }}
		</a>
	</li>
{% endmacro %}

{# =========================================================================
   CONFIG INFO ICON
   Renders the info icon that shows config tooltip on hover

   @param string configDisplay - The raw config PHP code to show in tooltip
   ========================================================================= #}

{% macro configInfoIcon(configDisplay) %}
	<span class="config-info-icon" data-config="{{ configDisplay|e('html_attr') }}"></span>
{% endmacro %}

{# =========================================================================
   DISABLED CHECKBOX
   Renders a disabled checkbox for config-source items

   @param string title - Tooltip text explaining why it's disabled
   ========================================================================= #}

{% macro disabledCheckbox(title) %}
	<div class="checkbox disabled" title="{{ title }}" tabindex="-1" aria-checked="false" aria-disabled="true" role="checkbox" style="opacity: 0.4; cursor: not-allowed; pointer-events: none;"></div>
{% endmacro %}

{# =========================================================================
   PAGINATION INFO
   Renders the pagination info text (e.g., "1 – 50 of 120 items")

   @param int offset - Current offset
   @param int limit - Items per page
   @param int totalCount - Total items
   @param string singular - Singular item name (e.g., 'index')
   @param string plural - Plural item name (e.g., 'indices')
   ========================================================================= #}

{% macro paginationInfo(offset, limit, totalCount, singular, plural) %}
	{% set endRange = min(offset + limit, totalCount) %}
	{% if totalCount == 0 %}
		{{ ('no ' ~ plural)|t('search-manager') }}
	{% else %}
		{{ offset + 1 }} – {{ endRange }} of {{ totalCount }} {{ totalCount == 1 ? singular : plural }}
	{% endif %}
{% endmacro %}

{# =========================================================================
   BACKEND COLOR
   Returns the color for a backend type (for use in filter menus)

   @param string backendType - The backend type
   @param string currentFilter - Currently selected filter value
   @return string - The hex color
   ========================================================================= #}

{% macro backendColor(backendType, currentFilter) %}
	{% set colors = {
		'mysql': '#f59e0b',
		'pgsql': '#3b82f6',
		'file': '#6b7280',
		'redis': '#dc2626',
		'typesense': '#8b5cf6',
		'algolia': '#06b6d4',
		'meilisearch': '#ec4899',
		'elasticsearch': '#fec514',
	} %}
	{{- currentFilter == backendType ? colors[backendType]|default('#9aa5b1') : '#aab6c1' -}}
{% endmacro %}

{# =========================================================================
   SOURCE COLOR
   Returns the color for a source type (for use in filter menus)

   @param string sourceType - 'config' or 'database'
   @param string currentFilter - Currently selected filter value
   @return string - The hex color
   ========================================================================= #}

{% macro sourceColor(sourceType, currentFilter) %}
	{% set colors = {
		'config': '#f59e0b',
		'database': '#3b82f6',
	} %}
	{{- currentFilter == sourceType ? colors[sourceType]|default('#9aa5b1') : '#aab6c1' -}}
{% endmacro %}

{# =========================================================================
   BACKEND TYPE FILTER MENU
   Renders the Backend Type filter section for dropdown menus

   @param string typeFilter - current filter value
   @param string statusFilter - current status filter
   @param string sourceFilter - current source filter
   @param string search - current search query
   @param array types - array of { type: 'mysql', label: 'MySQL' } objects
   ========================================================================= #}

{% macro backendTypeFilterMenu(typeFilter, statusFilter, sourceFilter, search, types) %}
	{% set colors = {
		'mysql': '#f59e0b',
		'pgsql': '#3b82f6',
		'file': '#6b7280',
		'redis': '#dc2626',
		'typesense': '#8b5cf6',
		'algolia': '#06b6d4',
		'meilisearch': '#ec4899',
		'elasticsearch': '#fec514',
	} %}

	<li><hr class="padded"></li>
	<li class="menu-header">{{ 'Backend Type'|t('search-manager') }}</li>
	<li>
		<a class="{{ typeFilter == 'all' ? 'sel' : '' }}" href="?status={{ statusFilter }}&type=all&source={{ sourceFilter }}&search={{ search }}">
			<span class="status all"></span>{{ 'All Types'|t('search-manager') }}
		</a>
	</li>
	{% for item in types %}
		<li>
			<a class="{{ typeFilter == item.type ? 'sel' : '' }}" href="?status={{ statusFilter }}&type={{ item.type }}&source={{ sourceFilter }}&search={{ search }}">
				<span class="status" style="background: {{ typeFilter == item.type ? colors[item.type]|default('#9aa5b1') : '#aab6c1' }};"></span>{{ item.label|t('search-manager') }}
			</a>
		</li>
	{% endfor %}
{% endmacro %}
