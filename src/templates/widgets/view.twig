{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set title = widgetConfig.name %}
{% set fullPageForm = false %}
{% set selectedSubnavItem = 'widgets' %}

{% set crumbs = [
    { label: searchHelper.fullName, url: url('search-manager') },
    { label: 'Widgets'|t('search-manager'), url: url('search-manager/widgets') },
    { label: widgetConfig.name }
] %}

{% block content %}
	<div class="pane">
		<h2>{{ 'Widget Details'|t('search-manager') }}</h2>
		<p class="light">{{ 'This widget is defined in your config file and cannot be edited here.'|t('search-manager') }}</p>

		<table class="data fullwidth">
			<tbody>
				<tr>
					<th class="light" style="width: 150px;">{{ 'Name'|t('search-manager') }}</th>
					<td>{{ widgetConfig.name }}</td>
				</tr>
				<tr>
					<th class="light">{{ 'Handle'|t('search-manager') }}</th>
					<td><code>{{ widgetConfig.handle }}</code></td>
				</tr>
				<tr>
					<th class="light">{{ 'Status'|t('search-manager') }}</th>
					<td>
						<span class="status {{ widgetConfig.enabled ? 'live' : 'disabled' }}"></span>
						{{ widgetConfig.enabled ? 'Enabled'|t('search-manager') : 'Disabled'|t('search-manager') }}
					</td>
				</tr>
				<tr>
					<th class="light">{{ 'Default'|t('search-manager') }}</th>
					<td>
						{% set isDefault = defaultWidgetHandle == widgetConfig.handle %}
						{% if isDefault %}
							<span class="status live"></span> {{ 'Yes'|t('search-manager') }}
						{% else %}
							<span class="light">{{ 'No'|t('search-manager') }}</span>
						{% endif %}
					</td>
				</tr>
				<tr>
					<th class="light">{{ 'Source'|t('search-manager') }}</th>
					<td>
						<span class="token orange">{{ 'config'|t('search-manager') }}</span>
						<span class="light"> - config/search-manager.php</span>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<div class="pane">
		<h2>{{ 'Configuration'|t('search-manager') }}</h2>
		<p class="light">{{ 'The settings for this widget as defined in your config file.'|t('search-manager') }}</p>
		<pre style="background: #f3f7fc; padding: 14px; border-radius: 4px; overflow-x: auto; font-size: 12px;"><code>{{ widgetConfig.settings|json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_SLASHES')) }}</code></pre>
	</div>

	<div class="pane">
		<h2>{{ 'Usage in Templates'|t('search-manager') }}</h2>
		<p class="light">{{ 'Include this widget in your Twig templates using:'|t('search-manager') }}</p>
		<div style="background: #f3f7fc; padding: 14px; border-radius: 4px; font-family: monospace; font-size: 12px; line-height: 1.5;">
			<code style="display: block; white-space: pre-wrap; word-break: break-all;">{% verbatim %}{% include 'search-manager/_widget/search' with {
    config: '{% endverbatim %}{{ widgetConfig.handle }}{% verbatim %}',
} %}{% endverbatim %}</code>
		</div>
	</div>

{% endblock %}

{% block details %}
	<div class="meta read-only">
		<div class="data">
			<h5 class="heading">{{ 'Handle'|t('search-manager') }}</h5>
			<div class="value"><code>{{ widgetConfig.handle }}</code></div>
		</div>
		<div class="data">
			<h5 class="heading">{{ 'Status'|t('search-manager') }}</h5>
			<div class="value">
				<span class="status {{ widgetConfig.enabled ? 'live' : 'disabled' }}"></span>
				{{ widgetConfig.enabled ? 'Enabled'|t('search-manager') : 'Disabled'|t('search-manager') }}
			</div>
		</div>
	</div>

	{# Widget Preview #}
	{% include "search-manager/widgets/_partials/preview" with {
		widgetConfig: widgetConfig
	} %}
{% endblock %}

{% js %}
// Light/Dark preview toggle
(function() {
	const lightPreview = document.querySelector('.widget-preview-light');
	const darkPreview = document.querySelector('.widget-preview-dark');
	const toggleButtons = document.querySelectorAll('.widget-preview-toggle button');

	if (!lightPreview || !darkPreview || !toggleButtons.length) return;

	toggleButtons.forEach(function(btn) {
		btn.addEventListener('click', function() {
			const mode = this.getAttribute('data-preview-mode');

			// Update button states
			toggleButtons.forEach(function(b) {
				const isActive = b.getAttribute('data-preview-mode') === mode;
				b.setAttribute('aria-pressed', isActive ? 'true' : 'false');
				b.classList.toggle('secondary', isActive);
			});

			// Show/hide previews
			lightPreview.style.display = mode === 'light' ? 'block' : 'none';
			darkPreview.style.display = mode === 'dark' ? 'block' : 'none';
		});
	});
})();
{% endjs %}
