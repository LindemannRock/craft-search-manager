{# Backend type labels for proper display #}
{% set backendLabels = {
    'algolia': 'Algolia',
    'meilisearch': 'Meilisearch',
    'typesense': 'Typesense',
    'mysql': 'MySQL',
    'pgsql': 'PostgreSQL',
    'redis': 'Redis',
    'file': 'File',
} %}

<h2 class="lr-section-heading lr-heading-tight">{{ "Content Gaps (Zero-Hit Clusters)"|t('search-manager') }}</h2>
<p class="light lr-paragraph">
    {{ "These groups of queries returned no hits. This indicates missing content or topics your users are looking for."|t('search-manager') }}
</p>

<div class="lr-analytics-charts">
    <div class="lr-chart-container full-width">
        <div class="lr-table-scroll">
            <table class="data fullwidth">
                <thead>
                    <tr>
                        <th>{{ 'Main Term'|t('search-manager') }}</th>
                        <th>{{ 'Total Searches'|t('search-manager') }}</th>
                        <th>{{ 'Related Queries'|t('search-manager') }}</th>
                        <th>{{ 'Last Searched'|t('search-manager') }}</th>
                    </tr>
                </thead>
                <tbody id="content-gaps-body">
                    {# Populated via JS #}
                    <tr><td colspan="4" class="thin light lr-text-center">{{ "Loading content gaps..."|t('search-manager') }}</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<h2 class="lr-section-heading">{{ "Recent Zero-Hit Queries"|t('search-manager') }}</h2>

<div class="lr-analytics-charts">
    <div class="lr-chart-container full-width">
        <div class="lr-table-scroll">
            <table class="data fullwidth">
                <thead>
                    <tr>
                        <th>{{ 'Query'|t('search-manager') }}</th>
                        <th>{{ 'Site'|t('search-manager') }}</th>
                        <th>{{ 'Index'|t('search-manager') }}</th>
                        <th>{{ 'Backend'|t('search-manager') }}</th>
                        <th>{{ 'Date'|t('search-manager') }}</th>
                        <th>{{ 'Time'|t('search-manager') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in recentUnhandled %}
                        <tr>
                            <td><code>{{ stat.query }}</code></td>
                            <td>
                                {% if stat.siteId %}
                                    {% set site = craft.app.sites.getSiteById(stat.siteId) %}
                                    {{ site ? site.name : '—' }}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td>{{ stat.indexHandle }}</td>
                            <td>{{ backendLabels[stat.backend] ?? stat.backend|title }}</td>
                            <td>{{ stat.dateCreated|lrDate('short') }}</td>
                            <td>{{ stat.dateCreated|lrTime('short') }}</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="thin light lr-text-center">{{ "All searches have hits!"|t('search-manager') }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
